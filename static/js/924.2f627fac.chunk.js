"use strict";(self.webpackChunkenergy_balance=self.webpackChunkenergy_balance||[]).push([[924],{4924:(e,t,a)=>{a.r(t),a.d(t,{default:()=>b});var n=a(2555),s=a(5043),i=a(3216),o=a(5472),l=a(303),r=(a(1775),a(7523)),c=a(579);const d=(e,t)=>{const a=e.time,n=a.match(/(\d+):/),s=n?parseInt(n[1],10):12,i=a.toLowerCase().includes("pm");let o=s;i&&12!==s&&(o+=12),i||12!==s||(o=0);const l=.2*(parseFloat(e.protein)||0),r=.1*(parseFloat(e.carbs)||0),c=.15*(parseFloat(e.fat)||0);let d=1;o<6||o>20?d=.7:o>=7&&o<=10?d=1.2:o>=17&&o<=19&&(d=.9);const m={Breakfast:1.3,"Morning Snack":.9,Lunch:1.1,"Afternoon Snack":.8,Dinner:.9,"Late Night Snack":.6}[e.mealType]||1;let u=Math.min(100,10*(l+r+c))*d*m;if(e.longCovidAdjust&&null!==t&&void 0!==t&&t.hasLongCovid){u*={mild:.95,moderate:.85,severe:.75,"very severe":.65}[null===(h=t.longCovidSeverity)||void 0===h?void 0:h.toLowerCase()]||.85,e.longCovidBenefits&&e.longCovidBenefits.length>0&&(u*=1.1),e.longCovidCautions&&e.longCovidCautions.length>0&&(u*=.9)}var h;return Math.min(100,Math.max(0,u))},m=e=>{const t=e.split("-");return new Date(parseInt(t[0]),parseInt(t[1])-1,parseInt(t[2]))},u=e=>{const t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),n=String(e.getDate()).padStart(2,"0");return"".concat(t,"-").concat(a,"-").concat(n)};function h(e){let{userData:t,userIntake:a={}}=e;const i=(0,s.useRef)(null),[o,l]=(0,s.useState)(null),d=(0,s.useCallback)((e=>{const t=(e,t)=>e&&t?e/Math.pow(t/100,2):null,a=(e=>{const{age:a,gender:n,weight:s,height:i,activity_level:o}=e;if(!a||!s||!i)return 2e3;let l;l="female"===n?10*s+6.25*i-5*a-161:10*s+6.25*i-5*a+5;let r=l*({sedentary:1.2,light:1.375,moderate:1.55,very:1.725,extreme:1.9}[o]||1.375);e.covid_condition&&(r*=1.07);const c=t(s,i);return c&&(c<18.5?r*=1.1:c>30&&(r*=.9)),Math.round(r)})(e),n=((e,a)=>{if(!e)return null;let n=.25,s=.45,i=.3;a.covid_condition&&(n=.3,s=.4,i=.3);const o=t(a.weight,a.height);if(o&&o<18.5&&(i=.35,s=.45,n=.2),o&&o>30&&(n=.35,s=.35,i=.3),a.age>65){n=Math.min(n+.05,.4);const e=1-n;s=e*(s/(s+i)),i=e*(i/(s+i))}return{protein:n,carbs:s,fat:i}})(a,e),s=(a*n.protein/4).toFixed(1),i=(a*n.carbs/4).toFixed(1),o=(a*n.fat/9).toFixed(1),l="Increased to support immune function and tissue repair",r="Focus on complex carbs with anti-inflammatory properties",c="Higher proportion of omega-3s recommended to reduce inflammation";return{protein:{value:parseFloat(s),covidNote:e.covid_condition?l:null},carbs:{value:parseFloat(i),covidNote:e.covid_condition?r:null},fat:{value:parseFloat(o),covidNote:e.covid_condition?c:null},calories:{value:a}}}),[]);return(0,s.useEffect)((()=>{if(t){const e=d(t);l(e)}}),[t,d]),(0,s.useEffect)((()=>{if(!i.current||!o||!a)return;r.Ltv(i.current).selectAll("*").remove();const e=40,s=180,l=60,c=70,d=700-c-s,m=350-e-l,u=r.Ltv(i.current).append("svg").attr("width",d+c+s).attr("height",m+e+l).append("g").attr("transform","translate(".concat(c,",").concat(e,")")),h=["protein","carbs","fat"],g=[(0,n.A)({name:"Current Intake"},a),{name:"Recommended",protein:o.protein.value,carbs:o.carbs.value,fat:o.fat.value}],p={protein:"#22c55e",carbs:"#3b82f6",fat:"#f59e0b"},f=r.WH().domain(g.map((e=>e.name))).range([0,d]).padding(.3),v=r.T9B(g,(e=>e.protein+e.carbs+e.fat)),x=r.m4Y().domain([0,1.1*v]).range([m,0]);u.append("g").attr("transform","translate(0,".concat(m,")")).call(r.l78(f)).selectAll("text").attr("font-size","12px").attr("font-weight",(e=>"Recommended"===e?"bold":"normal")),u.append("g").call(r.V4s(x).ticks(5)).selectAll("text").attr("font-size","12px"),u.append("text").attr("transform","rotate(-90)").attr("y",20-c).attr("x",-m/2).attr("font-size","14px").attr("text-anchor","middle").attr("fill","#666").text("Grams");const y=(new Date).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"});u.append("text").attr("x",d/2).attr("y",-e/2).attr("text-anchor","middle").attr("font-size","16px").attr("font-weight","bold").attr("fill","#333").text("Long COVID Macronutrient Analysis - ".concat(y)),g.forEach((e=>{let t=0;e.stackedData=h.map((a=>({nutrient:a,y0:t,y1:t+=e[a]||0})))}));const j=r.Ltv("body").append("div").attr("class","d3-tooltip").style("position","absolute").style("background-color","white").style("border","1px solid #ddd").style("border-radius","4px").style("padding","8px").style("font-size","12px").style("pointer-events","none").style("opacity",0).style("box-shadow","0 2px 4px rgba(0,0,0,0.1)").style("z-index",100);u.selectAll(".bar-group").data(g).join("g").attr("class","bar-group").attr("transform",(e=>"translate(".concat(f(e.name),",0)"))).selectAll("rect").data((e=>e.stackedData)).join("rect").attr("width",f.bandwidth()).attr("y",(e=>x(e.y1))).attr("height",(e=>x(e.y0)-x(e.y1))).attr("fill",(e=>p[e.nutrient])).attr("stroke","white").attr("stroke-width",1).on("mouseover",(function(e,t){const a=r.Ltv(this.parentNode).datum(),n=a[t.nutrient].toFixed(1),s=(a[t.nutrient]/(a.protein+a.carbs+a.fat)*100).toFixed(1),i="fat"===t.nutrient?9:4,l=(a[t.nutrient]*i).toFixed(0),c="Recommended"===a.name&&o[t.nutrient].covidNote?'<br><span style="color:#6366f1;font-style:italic">'.concat(o[t.nutrient].covidNote,"</span>"):"";j.style("opacity",1).html('\n          <div style="font-weight:bold;text-transform:capitalize;color:'.concat(p[t.nutrient],'">').concat(t.nutrient,'</div>\n          <div style="margin:4px 0">\n            <b>Amount:</b> ').concat(n,"g\n            <br><b>Percentage:</b> ").concat(s,"%\n            <br><b>Calories:</b> ").concat(l," kcal\n            ").concat(c,"\n          </div>\n        ")).style("left",e.pageX+10+"px").style("top",e.pageY-28+"px"),r.Ltv(this).attr("stroke","#333").attr("stroke-width",2)})).on("mouseout",(function(){j.style("opacity",0),r.Ltv(this).attr("stroke","white").attr("stroke-width",1)}));const b=u.append("g").attr("class","legend").attr("transform","translate(".concat(d+20,", 0)"));h.forEach(((e,t)=>{const a=b.append("g").attr("transform","translate(0, ".concat(25*t,")"));a.append("rect").attr("width",15).attr("height",15).attr("fill",p[e]),a.append("text").attr("x",24).attr("y",12).attr("text-anchor","start").style("text-transform","capitalize").style("font-size","14px").text(e)})),null!==t&&void 0!==t&&t.covid_condition&&u.append("text").attr("x",d/2).attr("y",m+40).attr("text-anchor","middle").attr("font-size","12px").attr("font-style","italic").attr("fill","#6366f1").text("Note: RDA values adjusted for Long COVID recovery needs");const N=u.append("g").attr("class","calorie-info").attr("transform","translate(".concat(d+20,", ").concat(25*h.length+20,")"));return N.append("text").attr("font-size","14px").attr("font-weight","bold").text("Total Calories:"),N.append("text").attr("y",25).attr("font-size","14px").text("Intake: ".concat((e=>(4*e.protein+4*e.carbs+9*e.fat).toFixed(0))(a)," kcal")),N.append("text").attr("y",50).attr("font-size","14px").text("Recommended: ".concat(o.calories.value.toFixed(0)," kcal")),()=>{r.Ltv(".d3-tooltip").remove()}}),[i,o,a,t]),(0,c.jsx)("div",{className:"w-full",children:(0,c.jsx)("div",{ref:i,className:"macro-chart mx-auto overflow-visible",style:{minHeight:"350px"}})})}function g(e){let{data:t,userData:a,foodDatabase:i}=e;const o=(0,s.useRef)(null),[l,h]=(0,s.useState)([]);return(0,s.useEffect)((()=>{if(!t||0===t.length)return;const e=new Date,s=new Date;s.setDate(e.getDate()-7);const i=u(s),o=t.filter((e=>{try{return t=e.date,a=i,m(t)>=m(a)}catch(n){return console.warn("Error parsing date:",e.date),!1}var t,a})).map(((e,t)=>{try{console.log("Calculating efficiency for ".concat(e.name," using enhanced function"));const t=d(e,a),s=t&&t>0?t:e.efficiency||e.metabolicEfficiency||80;return console.log("Final efficiency for ".concat(e.name,": ").concat(s)),(0,n.A)((0,n.A)({},e),{},{originalEfficiency:e.efficiency||e.metabolicEfficiency||80,efficiency:s,actualEnergy:Math.round(e.calories*(s/100)),wastedEnergy:Math.round(e.calories*((100-s)/100))})}catch(s){console.warn("Error processing meal ".concat(t,":"),s);const a=e.efficiency||e.metabolicEfficiency||80;return(0,n.A)((0,n.A)({},e),{},{efficiency:a,actualEnergy:Math.round(e.calories*(a/100)),wastedEnergy:Math.round(e.calories*((100-a)/100))})}})).filter((e=>"Pre-workout"!==e.mealType&&"Post-workout"!==e.mealType));console.log("ProcessedData with consistent efficiency:",o),h(o)}),[t,a,i]),(0,s.useEffect)((()=>{if(!o.current||!l||0===l.length)return;r.Ltv(o.current).selectAll("*").remove();const e=60,t=20,a=50,s=50,i=900-s-t,c=450-e-a,d=r.Ltv(o.current).append("svg").attr("width",i+s+t).attr("height",c+e+a).append("g").attr("transform","translate(".concat(s,",").concat(e,")"));d.append("text").attr("x",i/2).attr("y",-30).attr("text-anchor","middle").style("font-size","18px").style("font-weight","bold").text("Enhanced Metabolic Efficiency Chart"),d.append("text").attr("x",i/2).attr("y",-10).attr("text-anchor","middle").style("font-size","14px").style("font-style","italic").text("Optimized for Long COVID energy management");const m=r.Ltv("body").append("div").attr("class","chart-tooltip").style("position","absolute").style("visibility","hidden").style("background-color","white").style("border","1px solid #ddd").style("border-radius","5px").style("padding","12px").style("font-size","14px").style("box-shadow","0 3px 14px rgba(0,0,0,0.25)").style("z-index","10").style("max-width","300px"),h=[],g=new Date;for(let n=6;n>=0;n--){const e=new Date;e.setDate(g.getDate()-n);const t=u(e);h.push(t)}console.log("=== ENHANCED CHART DEBUG ==="),console.log("processedData:",l);const p=[],f=r.Os0(l,(e=>e.date)),v=["Breakfast","Morning Snack","Lunch","Afternoon Snack","Dinner","Late Night Snack"];h.forEach((e=>{const t=f.get(e)||[];if(t.length>0){const a=r.Os0(t,(e=>e.mealType));v.forEach((t=>{const n=a.get(t);if(n&&n.length>0){const a=r.czq(n,(e=>e.calories)),s=n.reduce(((e,t)=>{const n=t.efficiency||0,s=a>0?t.calories/a:0;return console.log("Enhanced: ".concat(t.name,", efficiency: ").concat(n,", calories: ").concat(t.calories,", weight: ").concat(s)),e+n*s}),0);console.log("Enhanced combined efficiency for ".concat(t," on ").concat(e,": ").concat(s));const i=r.czq(n,(e=>e.actualEnergy||e.calories*(e.efficiency/100))),o=a-i;p.push({date:e,mealType:t,time:n[0].time,name:"".concat(t," (").concat(n.length," items)"),efficiency:Math.round(s),calories:a,actualEnergy:i,wastedEnergy:o,originalMeals:n,mealOrder:v.indexOf(t)})}}))}})),console.log("Enhanced Final combinedData:",p),console.log("=== END ENHANCED CHART DEBUG ===");const x=[...p].sort(((e,t)=>e.date!==t.date?e.date.localeCompare(t.date):e.mealOrder-t.mealOrder)),y=r.WH().domain(h).range([0,i]).padding(.2),j=r.WH().domain(v).range([0,y.bandwidth()]).padding(.1),b=r.T9B(p,(e=>e.calories))||1e3,N=r.m4Y().domain([0,b]).range([c,0]),C=r.m4Y().domain([0,100]).range([c,0]);d.append("g").attr("transform","translate(0,".concat(c,")")).call(r.l78(y).tickFormat((e=>{const t=e.split("-");return"".concat(parseInt(t[1]),"/").concat(parseInt(t[2]))}))).selectAll("text").style("text-anchor","end").attr("dx","-.8em").attr("dy",".15em").attr("transform","rotate(-45)"),d.append("g").call(r.V4s(N)).append("text").attr("transform","rotate(-90)").attr("y",-50).attr("x",-c/2).attr("text-anchor","middle").style("fill","#000").text("Calories"),d.append("g").attr("transform","translate(".concat(i,", 0)")).call(r.eH3(C)).append("text").attr("transform","rotate(-90)").attr("y",50).attr("x",-c/2).attr("text-anchor","middle").style("fill","#000").text("Enhanced Efficiency (%)");const w={Breakfast:"#DC2626","Morning Snack":"#EA580C",Lunch:"#16A34A","Afternoon Snack":"#0891B2",Dinner:"#7C3AED","Late Night Snack":"#BE185D"};if(p.forEach((e=>{const t=w[e.mealType]||"#999999",a=y(e.date)+j(e.mealType),n=j.bandwidth();d.append("rect").attr("class","actual-energy-bar").attr("x",a).attr("y",N(e.actualEnergy)).attr("width",n).attr("height",c-N(e.actualEnergy)).attr("fill",t).attr("opacity",.9).attr("stroke","#333").attr("stroke-width",1).on("mouseover",(function(t){r.Ltv(this).attr("opacity",.7),m.style("visibility","visible").html('\n              <div style="font-weight:bold;margin-bottom:10px;font-size:15px;">'.concat(e.date," - ").concat(e.mealType,'</div>\n              <div style="margin-bottom:6px;">Total Calories: ').concat(Math.round(e.calories),'</div>\n              <div style="margin-bottom:6px;"><strong>Enhanced Efficiency: ').concat(e.efficiency,'%</strong></div>\n              <div style="margin-bottom:6px;">Usable Energy: ').concat(Math.round(e.actualEnergy),' cal</div>\n              <div style="margin-bottom:12px;">Energy Lost: ').concat(Math.round(e.wastedEnergy),' cal</div>\n              <div style="font-weight:bold;margin-bottom:5px;">Individual Items:</div>\n              <ul style="margin-top:0;padding-left:20px;">\n                ').concat(e.originalMeals.map((e=>"\n                  <li>".concat(e.name," - ").concat(e.calories," cal (").concat(Math.round(e.efficiency),"% efficient)</li>\n                "))).join(""),"\n              </ul>\n            ")).style("left","".concat(t.pageX+15,"px")).style("top","".concat(t.pageY-10,"px"))})).on("mouseout",(function(){r.Ltv(this).attr("opacity",.9),m.style("visibility","hidden")})),d.append("rect").attr("class","potential-energy-bar").attr("x",a).attr("y",N(e.calories)).attr("width",n).attr("height",N(e.actualEnergy)-N(e.calories)).attr("fill",t).attr("opacity",.3).attr("stroke","#333").attr("stroke-width",1).attr("stroke-dasharray","3,3")})),x.length>0){const e=[...x.map(((e,t)=>{const a=y(e.date)+j(e.mealType)+j.bandwidth()/2;return(0,n.A)((0,n.A)({},e),{},{xPos:a,chronologicalIndex:t})}))].sort(((e,t)=>e.xPos-t.xPos)),t=r.n8j().x((e=>e.xPos)).y((e=>C(e.efficiency))).defined((e=>null!=e.efficiency&&!isNaN(e.efficiency))).curve(r.nVG);d.append("path").datum(e).attr("fill","none").attr("stroke","grey").attr("stroke-width",3).attr("d",t),d.selectAll(".efficiency-point").data(e).enter().append("circle").attr("class","efficiency-point").attr("cx",(e=>e.xPos)).attr("cy",(e=>C(e.efficiency))).attr("r",5).attr("fill","grey").attr("stroke","#333").attr("stroke-width",1).on("mouseover",(function(e,t){r.Ltv(this).attr("r",8),m.style("visibility","visible").html('\n              <div style="font-weight:bold;font-size:16px;">'.concat(t.mealType," - ").concat(t.time,'</div>\n              <div style="font-weight:bold;font-size:14px;">').concat(t.date,"</div>\n              <div>Enhanced Efficiency: <strong>").concat(t.efficiency,'%</strong></div>\n              <div style="margin-top:6px">Calculated using enhanced Long COVID algorithms</div>\n            ')).style("left","".concat(e.pageX+15,"px")).style("top","".concat(e.pageY-10,"px"))})).on("mouseout",(function(){r.Ltv(this).attr("r",5),m.style("visibility","hidden")}))}const k=c+100;d.append("line").attr("x1",10).attr("x2",40).attr("y1",k).attr("y2",k).attr("stroke","grey").attr("stroke-width",3),d.append("circle").attr("cx",25).attr("cy",k).attr("r",5).attr("fill","grey").attr("stroke","#333").attr("stroke-width",1),d.append("text").attr("x",50).attr("y",k+4).style("font-size","12px").text("Enhanced Efficiency (%)");const A=[{label:"Usable Energy",color:"#DC2626",opacity:.9},{label:"Energy Lost",color:"#DC2626",opacity:.3}];d.selectAll(".legend-rect").data(A).enter().append("rect").attr("x",200).attr("y",((e,t)=>k-10+20*t)).attr("width",15).attr("height",15).attr("fill",(e=>e.color)).attr("opacity",(e=>e.opacity)).attr("stroke","#333").attr("stroke-width",1),d.selectAll(".legend-text").data(A).enter().append("text").attr("x",225).attr("y",((e,t)=>k+2+20*t)).style("font-size","12px").text((e=>e.label));const S=Object.entries(w).map((e=>{let[t,a]=e;return{type:t,color:a}}));return d.selectAll(".meal-type-rect").data(S).enter().append("rect").attr("x",((e,t)=>400+140*Math.floor(t/3))).attr("y",((e,t)=>k-10+t%3*20)).attr("width",15).attr("height",15).attr("fill",(e=>e.color)).attr("stroke","#333").attr("stroke-width",1),d.selectAll(".meal-type-text").data(S).enter().append("text").attr("x",((e,t)=>425+140*Math.floor(t/3))).attr("y",((e,t)=>k+2+t%3*20)).style("font-size","12px").text((e=>e.type)),()=>{r.Ltv(".chart-tooltip").remove()}}),[o,l,a]),l&&0!==l.length?(0,c.jsxs)("div",{style:{width:"100%",minHeight:"900px",display:"flex",flexDirection:"column"},children:[(0,c.jsx)("div",{ref:o,className:"efficiency-chart",style:{height:"600px",width:"100%",overflow:"visible",flexShrink:0}}),(0,c.jsxs)("div",{style:{marginTop:"40px",padding:"25px",backgroundColor:"#f8f9fa",borderRadius:"8px",width:"100%",boxSizing:"border-box",flexShrink:0,border:"1px solid #dee2e6"},children:[(0,c.jsx)("h4",{style:{marginTop:"0",marginBottom:"20px",fontSize:"20px",fontWeight:"bold",color:"#333"},children:"Enhanced Metabolic Efficiency"}),(0,c.jsx)("p",{style:{marginBottom:"20px",lineHeight:"1.6",fontSize:"16px",color:"#555"},children:"This enhanced chart uses advanced algorithms that take into account Long COVID severity, meal timing, macronutrient balance, and individual factors to provide more accurate efficiency calculations for energy management. The efficiency line follows proper chronological order."}),(0,c.jsxs)("div",{style:{marginTop:"20px"},children:[(0,c.jsx)("strong",{style:{fontSize:"18px",color:"#333"},children:"Enhanced Features:"}),(0,c.jsxs)("ul",{style:{marginTop:"15px",paddingLeft:"30px",lineHeight:"1.8",fontSize:"15px",color:"#555"},children:[(0,c.jsx)("li",{style:{marginBottom:"8px"},children:"Long COVID severity adjustments (metabolic efficiency factors)"}),(0,c.jsx)("li",{style:{marginBottom:"8px"},children:"Circadian rhythm timing optimization"}),(0,c.jsx)("li",{style:{marginBottom:"8px"},children:"Macronutrient balance scoring"}),(0,c.jsx)("li",{style:{marginBottom:"8px"},children:"Anti-inflammatory food benefits/cautions"}),(0,c.jsx)("li",{style:{marginBottom:"8px"},children:"Chronologically ordered efficiency tracking"})]})]})]})]}):(0,c.jsx)("div",{className:"chart-container",style:{width:"100%",minHeight:"300px"},children:(0,c.jsx)("div",{ref:o,className:"efficiency-chart",children:(0,c.jsx)("div",{className:"placeholder",children:(0,c.jsx)("p",{children:"No meal data available for enhanced efficiency analysis."})})})})}const p={vitamin_a:{value:900,unit:"mcg",femaleAdjust:.78,description:"Supports vision, immune function, and cell growth"},vitamin_c:{value:90,unit:"mg",femaleAdjust:.83,description:"Antioxidant that supports immune function and collagen production"},vitamin_d:{value:15,unit:"mcg",femaleAdjust:1,description:"Crucial for calcium absorption and bone health"},vitamin_e:{value:15,unit:"mg",femaleAdjust:1,description:"Antioxidant that protects cells from damage"},vitamin_b6:{value:1.3,unit:"mg",femaleAdjust:1,description:"Important for metabolism and brain development"},vitamin_b12:{value:2.4,unit:"mcg",femaleAdjust:1,description:"Essential for nerve function and blood cell formation"},folate:{value:400,unit:"mcg",femaleAdjust:1,description:"Critical for cell division and DNA synthesis"},iron:{value:8,unit:"mg",femaleAdjust:2.25,description:"Essential for oxygen transport in the blood"},calcium:{value:1e3,unit:"mg",femaleAdjust:1,description:"Critical for bone health and muscle function"},magnesium:{value:420,unit:"mg",femaleAdjust:.76,description:"Involved in over 300 biochemical reactions in the body"},zinc:{value:11,unit:"mg",femaleAdjust:.73,description:"Important for immune function and wound healing"},selenium:{value:55,unit:"mcg",femaleAdjust:1,description:"Antioxidant that helps protect cells from damage"},copper:{value:.9,unit:"mg",femaleAdjust:1,description:"Important for red blood cell formation and nerve function"},vitamin_b1:{value:1.2,unit:"mg",femaleAdjust:.92,description:"Essential for energy metabolism"},vitamin_b2:{value:1.3,unit:"mg",femaleAdjust:.85,description:"Important for energy production and cell function"},vitamin_b3:{value:16,unit:"mg",femaleAdjust:.875,description:"Helps convert food into energy"}},f=e=>{let{data:t,maxPercent:a}=e;const n=Math.min(100,t.rawValue/t.rda*100),s=Math.round(t.rawValue/t.rda*100),i=Math.min(100,100);console.log("BulletChart Debug - ".concat(t.name,":"),{storedValue:t.value,rawValue:t.rawValue,rda:t.rda,calculatedPercentage:t.rawValue/t.rda*100,displayPercentage:s,actualWidth:n,shouldBeOptimal:t.value>=100||s>=100});const o=(l=n)>=100?"#4CAF50":l>=70?"#8BC34A":l>=50?"#FFC107":l>=30?"#FF9800":"#F44336";var l;return(0,c.jsxs)("div",{className:"bullet-chart",children:[(0,c.jsxs)("div",{className:"bullet-chart-header",children:[(0,c.jsxs)("div",{className:"bullet-chart-title",children:[(0,c.jsx)("span",{className:"nutrient-name",children:t.name}),t.isAdjusted&&(0,c.jsx)("span",{className:"adjusted-badge",children:"Adjusted"})]}),(0,c.jsxs)("div",{className:"bullet-chart-values",children:[t.rawValue.toFixed(2)," / ",t.rda," ",t.unit,(0,c.jsxs)("span",{className:"bullet-chart-percentage",style:{color:o},children:["(",s,"%)"]})]})]}),(0,c.jsxs)("div",{className:"bullet-chart-track",children:[(0,c.jsx)("div",{className:"threshold-marker",style:{left:"70%"}}),(0,c.jsx)("div",{className:"actual-value-bar",style:{width:"".concat(n,"%"),backgroundColor:o}}),(0,c.jsx)("div",{className:"target-line",style:{left:"".concat(i,"%")}})]})]})};function v(e){let{data:t,userData:a}=e;const[i,o]=(0,s.useState)(a||{}),[l,r]=(0,s.useState)([]),[d,m]=(0,s.useState)([]),[u]=(0,s.useState)(t&&Object.keys(t).length>0?function(e,t){console.log("=== FIXED ensureCompleteNutrientData ==="),console.log("Input intakeData:",e);const a={};for(const n in t){if(!t.hasOwnProperty(n))continue;const s=t[n];if(s&&void 0!==s.value&&s.unit)if(e&&void 0!==e[n]){const t=e[n];if("object"===typeof t&&null!==t&&void 0!==t.value&&void 0!==t.unit){let e=parseFloat(t.value)||0,i=t.unit;i!==s.unit&&("mcg"===i&&"mg"===s.unit?(e/=1e3,i="mg"):"mg"===i&&"mcg"===s.unit?(e*=1e3,i="mcg"):"g"===i&&"mg"===s.unit&&(e*=1e3,i="mg"),console.log("Converted ".concat(n,": ").concat(t.value," ").concat(t.unit," \u2192 ").concat(e," ").concat(i))),a[n]={value:e,unit:i}}else if("number"===typeof t)a[n]={value:t,unit:s.unit};else if("string"===typeof t){const e=parseFloat(t)||0;a[n]={value:e,unit:s.unit}}else console.warn("Unexpected intake format for ".concat(n,":"),t),a[n]={value:0,unit:s.unit}}else a[n]={value:0,unit:s.unit};else console.warn("Invalid RDA data for ".concat(n,":"),s)}return console.log("Output completeIntakeData:",a),console.log("=== END FIXED ensureCompleteNutrientData ===\n"),a}(t,p):{}),[h,g]=(0,s.useState)({}),[v,x]=(0,s.useState)("all"),[y,j]=(0,s.useState)(!0),[b,N]=(0,s.useState)("all"),C=(0,s.useCallback)((e=>{switch(null===e||void 0===e?void 0:e.toLowerCase()){case"mild":return 1.1;case"moderate":return 1.3;case"severe":return 1.5;case"very severe":return 1.8;default:return 1}}),[]),w=((0,s.useCallback)(((e,t,a)=>t===a?e:"g"===t&&"mg"===a||"mg"===t&&"mcg"===a?1e3*e:"mcg"===t&&"mg"===a||"mg"===t&&"g"===a?.001*e:(console.warn("Unit conversion from ".concat(t," to ").concat(a," not defined for value ").concat(e)),e)),[]),(0,s.useCallback)(((e,t,a)=>{if("IU"!==(null===a||void 0===a?void 0:a.toUpperCase()))return t;return t*({vitamin_a:.3,vitamin_d:.025,vitamin_e:.67}[e]||1)}),[]),(0,s.useCallback)(((e,t)=>{console.log("=== FIXED processNutrientData ==="),console.log("Processing",Object.keys(t).length,"nutrients");const a=[];for(const i in t){if(!t.hasOwnProperty(i))continue;const n=t[i];if(!n||void 0===n.value||!n.unit){console.warn("Skipping ".concat(i,": Invalid RDA info"),n);continue}const s=e[i];let o=0;s&&"object"===typeof s&&void 0!==s.value&&(o=parseFloat(s.value)||0);const l=n.value>0?o/n.value*100:0;l>1e4&&console.warn("\u26a0\ufe0f Extremely high percentage for ".concat(i,": ").concat(l,"% - possible unit error"));const r=i.replace(/_/g," ").replace(/\b\w/g,(e=>e.toUpperCase())),c=i.includes("vitamin")?"vitamins":"minerals",d={key:i,name:r,value:Math.round(l),rawValue:o,unit:n.unit,rda:n.value,rdaUnit:n.unit,isAdjustedRDA:n.isAdjusted||!1,percentOfRDA:Math.round(l),category:c};console.log("\u2705 ".concat(r,": ").concat(o).concat(n.unit," / ").concat(n.value).concat(n.unit," = ").concat(l.toFixed(1),"%")),a.push(d)}const n=a.sort(((e,t)=>e.percentOfRDA-t.percentOfRDA));console.log("=== PROCESSING SUMMARY ==="),console.log("Total nutrients processed:",n.length),console.log("Deficient (<70%):",n.filter((e=>e.value<70)).length),console.log("Optimal (\u2265100%):",n.filter((e=>e.value>=100)).length);const s=n.filter((e=>e.value>=100));return console.log("Optimal nutrients:",s.map((e=>"".concat(e.name,": ").concat(e.value,"%")))),console.log("=== END FIXED processNutrientData ===\n"),n}),[])),k=(0,s.useCallback)((e=>{let t=[...e];if("all"!==b&&(t=t.filter((e=>e.category===b))),console.log("=== FILTER DEBUG ==="),console.log("Before filtering:",t.length,"items"),console.log("Display mode:",v),console.log("Sample data values:",t.slice(0,3).map((e=>"".concat(e.name,": ").concat(e.value,"%")))),"deficient"===v)t=t.filter((e=>e.value<70)),t.sort(((e,t)=>e.value-t.value)),console.log("After deficient filter:",t.length,"items");else if("optimal"===v){const e=t.length;t=t.filter((e=>(console.log("Checking ".concat(e.name,": ").concat(e.value,"% >= 100? ").concat(e.value>=100)),e.value>=100))),console.log("Optimal filter: ".concat(e," \u2192 ").concat(t.length," items")),console.log("Optimal items:",t.map((e=>"".concat(e.name,": ").concat(e.value,"%")))),t.sort(((e,t)=>t.value-e.value))}else t.sort(((e,t)=>e.value-t.value));console.log("Final filtered data:",t.length,"items"),console.log("=== END FILTER DEBUG ==="),r(t)}),[v,b]),A=(0,s.useCallback)(((e,t)=>{if(!e||0===Object.keys(e).length)return console.error("baseRDAData_ is empty or invalid!"),{};const a=JSON.parse(JSON.stringify(e));return Object.keys(a).forEach((s=>{var i;if(!a[s]||"number"!==typeof a[s].value)return console.error("Invalid data structure for ".concat(s," in baseRDAData_ or copy:"),a[s]),void(a[s]={value:0,unit:(null===(i=a[s])||void 0===i?void 0:i.unit)||"mg",isAdjusted:!1});let o=a[s].value;if(null!==t&&void 0!==t&&t.gender&&"female"===t.gender.toLowerCase()){o*=a[s].femaleAdjust||1}if(null!==t&&void 0!==t&&t.age){let e=1;t.age>=70?("vitamin_d"===s&&(e=1.2),"vitamin_b12"===s&&(e=1.1),"calcium"===s&&(e=1.15)):t.age>=50?("vitamin_d"===s&&(e=1.1),"vitamin_b12"===s&&(e=1.05)):t.age<=18&&("calcium"===s&&(e=1.15),"iron"===s&&(e=1.1)),1!==e&&(o*=e)}const l=(null===t||void 0===t?void 0:t.covid_severity)||(null===t||void 0===t?void 0:t.longCovidSeverity);if(l&&"None"!==l&&null!==l&&void 0!==l){const e=C(l);if(["vitamin_c","vitamin_d","zinc","selenium"].includes(s)){o*=Math.min(1.5*e,2.5)}else if(["vitamin_a","vitamin_e","vitamin_b6","vitamin_b12","folate","iron"].includes(s)){o*=Math.min(1.3*e,2)}else if(["magnesium","copper","vitamin_b1","vitamin_b2","vitamin_b3"].includes(s)){o*=Math.min(1.1*e,1.5)}}(isNaN(o)||!isFinite(o)||o<=0)&&(console.error("Invalid final value for ".concat(s,": ").concat(o,", resetting to base")),o=a[s].value);const r=Math.round(10*o)/10;a[s]=(0,n.A)((0,n.A)({},a[s]),{},{value:r,isAdjusted:r!==e[s].value})})),a}),[C]),S=e=>e>=100?{label:"Optimal",color:"#4CAF50"}:e>=70?{label:"Good",color:"#8BC34A"}:e>=50?{label:"Moderate",color:"#FFC107"}:e>=30?{label:"Low",color:"#FF9800"}:{label:"Very Low",color:"#F44336"},D=e=>{const t={};for(const n in p)t[n.replace(/_/g," ")]=p[n].description;const a=t[e.toLowerCase()];if(a)return a;for(const n in t)if(e.toLowerCase().includes(n))return t[n];return""};(0,s.useEffect)((()=>{j(!0);const e=setTimeout((()=>{try{const e=A(p,i);if(!e||0===Object.keys(e).length)return console.error("Failed to calculate RDA values"),void j(!1);g(e);const t=w(u,e);console.log("=== PROCESSED DATA DEBUG ==="),console.log("Total processed nutrients:",t.length),t.forEach((e=>{console.log("".concat(e.name,": value=").concat(e.value,"%, rawValue=").concat(e.rawValue,", rda=").concat(e.rda))}));const a=t.filter((e=>e.value>=100)).length;console.log("Optimal count (\u2265100%):",a),console.log("=== END PROCESSED DATA DEBUG ==="),m(t),k(t)}catch(e){console.error("Error in MicronutrientChart useEffect:",e)}finally{j(!1)}}),500);return()=>clearTimeout(e)}),[i,u,A,w,k]),(0,s.useEffect)((()=>{d.length>0&&k(d)}),[v,b,d,k]);const E=()=>{var e,t;const a=[null,"mild","moderate","severe","very severe"],s=(null===(e=i.covid_severity)||void 0===e?void 0:e.toLowerCase())||(null===(t=i.longCovidSeverity)||void 0===t?void 0:t.toLowerCase())||null,l=a.indexOf(s),r=a[(l+1)%a.length],c=(0,n.A)((0,n.A)({},i),{},{covid_severity:r,longCovidSeverity:r,hasLongCovid:null!==r});null===r&&(delete c.covid_severity,delete c.longCovidSeverity,c.hasLongCovid=!1),o(c)},F=()=>{const e=i.covid_severity||i.longCovidSeverity;return e&&null!==e&&"None"!==e?e.charAt(0).toUpperCase()+e.slice(1):"None"},L=e=>{x(e)},I=e=>{N(e)};if(y)return(0,c.jsx)("div",{className:"loading-container",children:(0,c.jsxs)("div",{className:"loading-indicator",children:[(0,c.jsx)("div",{className:"spinner"}),(0,c.jsx)("p",{className:"loading-text",children:"Loading personalized micronutrient data..."})]})});const M=d.filter((e=>e.value<70)).length;return t&&0!==Object.keys(t).length||a&&0!==Object.keys(a).length?t&&0!==Object.keys(t).length&&0!==d.length?(0,c.jsxs)("div",{className:"micronutrient-chart-container",children:[(0,c.jsxs)("div",{className:"chart-card",children:[(0,c.jsxs)("div",{className:"chart-header",children:[(0,c.jsx)("h2",{className:"chart-title",children:"Micronutrient Status"}),(0,c.jsxs)("div",{className:"display-mode-buttons",children:[(0,c.jsxs)("button",{onClick:()=>L("all"),className:"mode-button ".concat("all"===v?"mode-button-active":""),children:["All (",d.length,")"]}),(0,c.jsxs)("button",{onClick:()=>L("deficient"),className:"mode-button ".concat("deficient"===v?"mode-button-deficient":""),children:["Deficient (",M,")"]}),(0,c.jsxs)("button",{onClick:()=>L("optimal"),className:"mode-button ".concat("optimal"===v?"mode-button-optimal":""),children:["Optimal (",d.filter((e=>e.percentOfRDA>=100)).length,")"]})]})]}),(0,c.jsxs)("div",{className:"category-filter",children:[(0,c.jsx)("button",{onClick:()=>I("all"),className:"category-button ".concat("all"===b?"category-button-active":""),children:"All Nutrients"}),(0,c.jsx)("button",{onClick:()=>I("vitamins"),className:"category-button ".concat("vitamins"===b?"category-button-active":""),children:"Vitamins"}),(0,c.jsx)("button",{onClick:()=>I("minerals"),className:"category-button ".concat("minerals"===b?"category-button-active":""),children:"Minerals"})]}),M>0&&(0,c.jsx)("div",{className:"deficiency-alert",children:(0,c.jsxs)("p",{className:"deficiency-message",children:[M," ",1===M?"nutrient is":"nutrients are"," below recommended levels."]})}),i.covid_severity&&"None"!==F()&&(0,c.jsxs)("div",{className:"covid-alert ".concat((e=>{switch(null===e||void 0===e?void 0:e.toLowerCase()){case"mild":return"covid-severity-mild";case"moderate":return"covid-severity-moderate";case"severe":return"covid-severity-severe";case"very severe":return"covid-severity-very-severe";default:return"covid-severity-unknown"}})(i.covid_severity)),children:[(0,c.jsxs)("p",{className:"covid-title",children:["Long COVID Condition - ",F()," Severity"]}),(0,c.jsx)("p",{className:"covid-description",children:"Recommended values have been adjusted for immune system support"})]}),(0,c.jsx)("div",{className:"chart-content",children:0===l.length&&d.length>0?(0,c.jsxs)("div",{className:"no-filter-results",children:[(0,c.jsx)("div",{className:"no-results-icon",children:"\ud83c\udfaf"}),(0,c.jsx)("h3",{className:"no-results-title",children:"Great news!"}),(0,c.jsxs)("p",{className:"no-results-message",children:["You don't have any ",(()=>{const e="deficient"===v?"below 70% RDA":"optimal"===v?"at 100%+ RDA":"";let t="vitamins"===b?"vitamins":"minerals"===b?"minerals":"nutrients";return e&&(t+=" ".concat(e)),t.trim()})()," to display.","deficient"===v&&" This means your nutrient levels are doing well in this category!","optimal"===v&&" Try logging more diverse meals to reach optimal levels."]}),(0,c.jsx)("p",{className:"no-results-suggestion",children:'Try selecting "All" to see your complete nutrient profile.'})]}):l.map((e=>(0,c.jsx)(f,{data:e,maxPercent:150,getNutrientStatus:S,getNutrientInfo:D},e.key)))}),(0,c.jsxs)("div",{className:"chart-legend",children:[(0,c.jsxs)("div",{className:"legend-item",children:[(0,c.jsx)("div",{className:"legend-color legend-optimal"}),(0,c.jsx)("span",{className:"legend-text",children:"\u2265 100% (Optimal)"})]}),(0,c.jsxs)("div",{className:"legend-item",children:[(0,c.jsx)("div",{className:"legend-color legend-good"}),(0,c.jsx)("span",{className:"legend-text",children:"70-99% (Good)"})]}),(0,c.jsxs)("div",{className:"legend-item",children:[(0,c.jsx)("div",{className:"legend-color legend-moderate"}),(0,c.jsx)("span",{className:"legend-text",children:"50-69% (Moderate)"})]}),(0,c.jsxs)("div",{className:"legend-item",children:[(0,c.jsx)("div",{className:"legend-color legend-low"}),(0,c.jsx)("span",{className:"legend-text",children:"30-49% (Low)"})]}),(0,c.jsxs)("div",{className:"legend-item",children:[(0,c.jsx)("div",{className:"legend-color legend-very-low"}),(0,c.jsx)("span",{className:"legend-text",children:"0-29% (Very Low)"})]}),(0,c.jsxs)("div",{className:"legend-item",children:[(0,c.jsx)("div",{className:"legend-target"}),(0,c.jsx)("span",{className:"legend-text",children:"Target (100% RDA)"})]}),(0,c.jsxs)("div",{className:"legend-item",children:[(0,c.jsx)("div",{className:"legend-threshold"}),(0,c.jsx)("span",{className:"legend-text",children:"Deficiency Threshold (70%)"})]})]})]}),(0,c.jsxs)("div",{className:"profile-card",children:[(0,c.jsx)("h3",{className:"profile-title",children:"User Profile"}),(0,c.jsxs)("div",{className:"profile-grid",children:[(0,c.jsxs)("div",{className:"profile-item",children:[(0,c.jsx)("p",{className:"profile-label",children:"Age"}),(0,c.jsxs)("p",{className:"profile-value",children:[(null===i||void 0===i?void 0:i.age)||"Not specified"," years"]})]}),(0,c.jsxs)("div",{className:"profile-item",children:[(0,c.jsx)("p",{className:"profile-label",children:"Gender"}),(0,c.jsx)("p",{className:"profile-value",children:null!==i&&void 0!==i&&i.gender?i.gender.charAt(0).toUpperCase()+i.gender.slice(1):"Not specified"})]}),(0,c.jsxs)("div",{className:"profile-item",children:[(0,c.jsx)("p",{className:"profile-label",children:"BMI"}),(0,c.jsx)("p",{className:"profile-value",children:null!==i&&void 0!==i&&i.weight&&null!==i&&void 0!==i&&i.height?(i.weight/Math.pow(i.height/100,2)).toFixed(1):"N/A"})]}),(0,c.jsxs)("div",{className:"profile-item",children:[(0,c.jsx)("p",{className:"profile-label",children:"Activity Level"}),(0,c.jsx)("p",{className:"profile-value",children:(null===i||void 0===i?void 0:i.activity_level)||"Not specified"})]}),(0,c.jsxs)("div",{className:"profile-item",children:[(0,c.jsx)("p",{className:"profile-label",children:"Medical Conditions"}),(0,c.jsx)("p",{className:"profile-value",children:null!==i&&void 0!==i&&i.medical_conditions&&i.medical_conditions.length>0?i.medical_conditions.map((e=>e.charAt(0).toUpperCase()+e.slice(1))).join(", "):"None"})]}),(0,c.jsxs)("div",{className:"profile-item",children:[(0,c.jsx)("p",{className:"profile-label",children:"COVID Status"}),(0,c.jsxs)("button",{onClick:E,className:"covid-toggle-button",style:{padding:"8px 12px",backgroundColor:"#e3f2fd",border:"2px solid #2196f3",borderRadius:"6px",cursor:"pointer",fontSize:"14px",fontWeight:"500",color:"#1976d2",transition:"all 0.2s ease",minWidth:"120px"},onMouseEnter:e=>{e.target.style.backgroundColor="#bbdefb",e.target.style.transform="scale(1.02)"},onMouseLeave:e=>{e.target.style.backgroundColor="#e3f2fd",e.target.style.transform="scale(1)"},children:[F()," (Click to change)"]})]})]})]})]}):(0,c.jsxs)("div",{className:"micronutrient-chart-container",children:[(0,c.jsxs)("div",{className:"chart-card",children:[(0,c.jsx)("div",{className:"chart-header",children:(0,c.jsx)("h2",{className:"chart-title",children:"Micronutrient Status"})}),(0,c.jsxs)("div",{className:"empty-state",children:[(0,c.jsx)("div",{className:"empty-state-icon",children:"\ud83d\udcca"}),(0,c.jsx)("h3",{className:"empty-state-title",children:"No Micronutrient Data Available"}),(0,c.jsx)("p",{className:"empty-state-description",children:"Once you log some meals, we'll analyze your nutrient intake and show your personalized micronutrient status here."})]})]}),(0,c.jsxs)("div",{className:"profile-card",children:[(0,c.jsx)("h3",{className:"profile-title",children:"User Profile"}),(0,c.jsxs)("div",{className:"profile-grid",children:[(0,c.jsxs)("div",{className:"profile-item",children:[(0,c.jsx)("p",{className:"profile-label",children:"Age"}),(0,c.jsxs)("p",{className:"profile-value",children:[(null===i||void 0===i?void 0:i.age)||"Not specified"," years"]})]}),(0,c.jsxs)("div",{className:"profile-item",children:[(0,c.jsx)("p",{className:"profile-label",children:"Gender"}),(0,c.jsx)("p",{className:"profile-value",children:null!==i&&void 0!==i&&i.gender?i.gender.charAt(0).toUpperCase()+i.gender.slice(1):"Not specified"})]}),(0,c.jsxs)("div",{className:"profile-item",children:[(0,c.jsx)("p",{className:"profile-label",children:"BMI"}),(0,c.jsx)("p",{className:"profile-value",children:null!==i&&void 0!==i&&i.weight&&null!==i&&void 0!==i&&i.height?(i.weight/Math.pow(i.height/100,2)).toFixed(1):"N/A"})]}),(0,c.jsxs)("div",{className:"profile-item",children:[(0,c.jsx)("p",{className:"profile-label",children:"Activity Level"}),(0,c.jsx)("p",{className:"profile-value",children:(null===i||void 0===i?void 0:i.activity_level)||"Not specified"})]}),(0,c.jsxs)("div",{className:"profile-item",children:[(0,c.jsx)("p",{className:"profile-label",children:"Medical Conditions"}),(0,c.jsx)("p",{className:"profile-value",children:null!==i&&void 0!==i&&i.medical_conditions&&i.medical_conditions.length>0?i.medical_conditions.map((e=>e.charAt(0).toUpperCase()+e.slice(1))).join(", "):"None"})]}),(0,c.jsxs)("div",{className:"profile-item",children:[(0,c.jsx)("p",{className:"profile-label",children:"COVID Status"}),(0,c.jsxs)("button",{onClick:E,className:"covid-toggle-button",style:{padding:"8px 12px",backgroundColor:"#e3f2fd",border:"2px solid #2196f3",borderRadius:"6px",cursor:"pointer",fontSize:"14px",fontWeight:"500",color:"#1976d2",transition:"all 0.2s ease",minWidth:"120px"},onMouseEnter:e=>{e.target.style.backgroundColor="#bbdefb",e.target.style.transform="scale(1.02)"},onMouseLeave:e=>{e.target.style.backgroundColor="#e3f2fd",e.target.style.transform="scale(1)"},children:[F()," (Click to change)"]})]})]})]})]}):(0,c.jsx)("div",{className:"micronutrient-chart-container",children:(0,c.jsxs)("div",{className:"chart-card",children:[(0,c.jsx)("div",{className:"chart-header",children:(0,c.jsx)("h2",{className:"chart-title",children:"Micronutrient Status"})}),(0,c.jsxs)("div",{className:"empty-state",children:[(0,c.jsx)("div",{className:"empty-state-icon",children:"\ud83d\udcca"}),(0,c.jsx)("h3",{className:"empty-state-title",children:"No Data Available"}),(0,c.jsx)("p",{className:"empty-state-description",children:"Please set up your profile and log some meals to see your personalized micronutrient analysis."})]})]})})}function x(e){let{foodLog:t,userProfile:a}=e;if(!t||!Array.isArray(t))return(0,c.jsxs)("div",{className:"analysis-error",children:[(0,c.jsx)("h3",{children:"Data Error"}),(0,c.jsx)("p",{children:"Unable to load food log data. Please try refreshing the page."})]});if(!a)return(0,c.jsxs)("div",{className:"analysis-error",children:[(0,c.jsx)("h3",{children:"Profile Error"}),(0,c.jsx)("p",{children:"User profile data is missing. Please check your account settings."})]});const n=u(new Date),s=t.length>0?t[0].date:n,i=t.filter((e=>e.date===n)),{macroSums:o,microSums:l,efficiencyData:r}=function(e){if(!e||!Array.isArray(e))return{macroSums:{},microSums:{},efficiencyData:[]};if(0===e.length)return{macroSums:{},microSums:{},efficiencyData:[]};const t=e[0].date,a=e.filter((e=>e.date===t));console.log("=== FIXED getChartData DEBUG ==="),console.log("Processing",a.length,"entries for date:",t);const n=a.reduce(((e,t)=>{const a=parseFloat(t.protein)||0,n=parseFloat(t.carbs)||0,s=parseFloat(t.fat)||0,i=parseFloat(t.calories)||0;return e.protein=(e.protein||0)+a,e.carbs=(e.carbs||0)+n,e.fat=(e.fat||0)+s,e.calories=(e.calories||0)+i,console.log("\u2705 Entry: ".concat(t.name," - P:").concat(a,"g C:").concat(n,"g F:").concat(s,"g Cal:").concat(i)),e}),{}),s={};return a.forEach(((e,t)=>{console.log("\n--- Processing Entry ".concat(t,": ").concat(e.name," ---")),e.micronutrients?Object.entries(e.micronutrients).forEach((e=>{let[t,a]=e;if(["protein","carbs","fat","calories","name","unit"].includes(t.toLowerCase()))return;let n=0,i="mg";if("object"===typeof a&&null!==a){if(void 0===a.value)return void console.warn("\u274c Object format not recognized for ".concat(t,":"),a);n=parseFloat(a.value)||0,i=a.unit||"mg"}else if("number"===typeof a)n=a;else{if("string"!==typeof a)return void console.warn("\u274c Unrecognized value format for ".concat(t,":"),a);n=parseFloat(a)||0}"zinc"!==t&&"selenium"!==t&&"copper"!==t||"mcg"!==i&&"\u03bcg"!==i||"zinc"!==t&&"copper"!==t||(n/=1e3,i="mg",console.log("\ud83d\udd04 Converted ".concat(t," from mcg to mg: ").concat(n)));const o={zinc:50,selenium:400,copper:10,iron:100,vitamin_c:2e3,vitamin_d:100,calcium:3e3,magnesium:1e3}[t]||1e4;(n<0||n>o)&&(console.warn("\u26a0\ufe0f Suspicious ".concat(t," value: ").concat(n," ").concat(i," (max expected: ").concat(o,") - using cautiously")),n=Math.min(n,o)),s[t]||(s[t]={value:0,unit:i}),s[t].value+=n,console.log("\u2795 ".concat(t,": +").concat(n," ").concat(i," \u2192 Total: ").concat(s[t].value," ").concat(i))})):console.log("\u26a0\ufe0f No micronutrients data for ".concat(e.name))})),console.log("\n=== FINAL SUMS ==="),console.log("Macros:",n),console.log("Micros:",s),Object.entries(s).forEach((e=>{let[t,a]=e;const n={zinc:100,selenium:1e3,copper:50,iron:200,vitamin_c:5e3}[t]||1e3;a.value>n&&console.warn("\u26a0\ufe0f Unusually high ".concat(t,": ").concat(a.value," ").concat(a.unit," (threshold: ").concat(n,")"))})),console.log("=== END FIXED DEBUG ===\n"),{macroSums:n,microSums:s,efficiencyData:e}}(t);return(0,c.jsxs)("div",{className:"food-analysis-section",children:[(0,c.jsxs)("div",{className:"analysis-header",children:[(0,c.jsx)("h3",{children:"\ud83d\udcca Nutritional Analysis Dashboard"}),(0,c.jsxs)("p",{className:"analysis-date",children:["Analysis for ",s]}),(0,c.jsx)("div",{className:"analysis-summary",children:(0,c.jsxs)("span",{className:"summary-stat",children:[(0,c.jsx)("strong",{children:i.length})," meals logged today (",n,")"]})})]}),(0,c.jsxs)("div",{className:"charts-container",children:[(0,c.jsxs)("div",{className:"chart-wrapper",children:[(0,c.jsxs)("div",{className:"chart-header",children:[(0,c.jsx)("h4",{children:"\ud83c\udf4e Macronutrient Balance"}),(0,c.jsx)("p",{className:"chart-description",children:"Your protein, carbohydrate, and fat intake compared to personalized recommendations"})]}),(0,c.jsx)(h,{userData:a,userIntake:o})]}),(0,c.jsxs)("div",{className:"chart-wrapper",children:[(0,c.jsxs)("div",{className:"chart-header",children:[(0,c.jsx)("h4",{children:"\ud83d\udc8a Micronutrient Status"}),(0,c.jsx)("p",{className:"chart-description",children:"Essential vitamins and minerals as percentage of recommended daily amounts"})]}),(0,c.jsx)(v,{data:l,userData:a})]}),(0,c.jsxs)("div",{className:"chart-wrapper",children:[(0,c.jsxs)("div",{className:"chart-header",children:[(0,c.jsx)("h4",{children:"\u26a1 Metabolic Efficiency"}),(0,c.jsx)("p",{className:"chart-description",children:"How effectively your body converts food calories into usable energy"})]}),(0,c.jsx)("div",{style:{width:"100%",overflow:"visible"},children:(0,c.jsx)(g,{data:r,userData:a})})]})]})]})}const y=["Breakfast","Morning Snack","Lunch","Afternoon Snack","Dinner","Late Night Snack"],j=["Add Food","Food Journal","Analysis"];const b=function(){var e;const t=(0,i.Zp)(),[a,r]=(0,s.useState)([]),[d,m]=(0,s.useState)("loading"),[u,h]=(0,s.useState)(!1),[g,p]=(0,s.useState)(!1),[f,v]=(0,s.useState)(null),[b,N]=(0,s.useState)({age:30,gender:"female",weight:65,height:165,activityLevel:"moderate",hasLongCovid:!1,longCovidSeverity:"moderate"}),[C,w]=(0,s.useState)(!0),[k,A]=(0,s.useState)("Add Food"),[S,D]=(0,s.useState)(""),[E,F]=(0,s.useState)([]),[L,I]=(0,s.useState)(null),[M,O]=(0,s.useState)({}),[_,T]=(0,s.useState)("Breakfast"),[B,P]=(0,s.useState)((()=>(new Date).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}))),[R,z]=(0,s.useState)((()=>(new Date).toISOString().slice(0,10))),[U,V]=(0,s.useState)(!0),[G,H]=(0,s.useState)(!1),[W,J]=(0,s.useState)(""),[Y,q]=(0,s.useState)(""),[X,Z]=(0,s.useState)([]),[Q,K]=(0,s.useState)(!1),[$,ee]=(0,s.useState)(""),[te,ae]=(0,s.useState)(1),[ne,se]=(0,s.useState)(null),[ie,oe]=(0,s.useState)(null),[le,re]=(0,s.useState)(!1),[ce,de]=(0,s.useState)({}),me=e=>{let{entryId:t,entryName:a,onConfirm:n,onCancel:s}=e;return(0,c.jsx)("div",{className:"modal-overlay",children:(0,c.jsxs)("div",{className:"delete-confirm-modal",children:[(0,c.jsx)("h3",{children:"\ud83d\uddd1\ufe0f Delete Food Entry"}),(0,c.jsx)("p",{children:"Are you sure you want to delete this food entry?"}),(0,c.jsx)("div",{className:"entry-preview",children:(0,c.jsx)("strong",{children:a})}),(0,c.jsx)("p",{className:"warning-text",children:"This action cannot be undone."}),(0,c.jsxs)("div",{className:"modal-actions",children:[(0,c.jsx)("button",{className:"cancel-button",onClick:s,disabled:le,children:"Cancel"}),(0,c.jsx)("button",{className:"delete-button",onClick:()=>n(t),disabled:le,children:le?"Deleting...":"Delete Entry"})]})]})})},ue=(0,s.useCallback)((async()=>{try{const e=localStorage.getItem("userData");if(!e)return void t("/login");const a=JSON.parse(e);v(a),a.id?await(async e=>{try{const t=(0,o.H9)(l.db,"users",e),a=await(0,o.x7)(t);if(a.exists()){const e=a.data();N(e)}else console.log("No user profile found in database"),N(null)}catch(t){console.error("Error fetching user profile:",t),q("Failed to load user profile"),N(null)}})(a.id):(console.log("No user ID found - user profile not loaded"),N(null))}catch(Y){console.error("Error checking authentication:",Y),t("/login")}finally{w(!1)}}),[t]);(0,s.useEffect)((()=>{ue()}),[ue]);const he=(0,s.useCallback)((async()=>{if(f&&f.id)try{const e=(0,o.P)((0,o.rJ)(l.db,"users",f.id,"food_journal"),(0,o.My)("date","desc"),(0,o.My)("createdAt","desc"),(0,o.AB)(20)),t=(await(0,o.GG)(e)).docs.map((e=>(0,n.A)({id:e.id},e.data())));Z(t),0===t.length?console.log("No food log entries found - showing empty state"):console.log("Loaded ".concat(t.length," food log entries"))}catch(Y){console.error("Error loading food log data:",Y),q("Failed to load food log data"),Z([])}}),[f]);(0,s.useEffect)((()=>{f&&f.id&&!C&&he()}),[f,C,he]);const ge=e=>{let{foodName:t,mealData:a}=e;if(a&&(a.longCovidRelevance||a.longCovidBenefits||a.longCovidCautions)){const e=a.longCovidRelevance||{},n=a.longCovidBenefits||[],s=a.longCovidCautions||[],i=a.functionalCompounds||{};let o="neutral";n.length>s.length&&(o="beneficial"),s.length>n.length&&(o="caution");const l=e.antiInflammatory||"unknown";return(0,c.jsxs)("div",{className:"long-covid-food-info ".concat(o),children:[(0,c.jsxs)("div",{className:"food-info-header",children:[(0,c.jsx)("span",{className:"category-icon ".concat(o),children:"beneficial"===o?"\u2705":"caution"===o?"\u26a0\ufe0f":"\u2139\ufe0f"}),(0,c.jsxs)("strong",{children:["Database Analysis: ",t]})]}),(0,c.jsxs)("div",{className:"inflammatory-level",children:[(0,c.jsx)("h5",{children:"\ud83d\udd25 Anti-Inflammatory Level"}),(0,c.jsxs)("div",{className:"level-indicator level-".concat(l),children:[(0,c.jsxs)("span",{className:"level-value",children:[" ",l.toUpperCase()]}),(0,c.jsx)("span",{className:"level-description",children:"high"===l?"Excellent for reducing inflammation":"moderate"===l?"Moderately helpful for inflammation":"low"===l?"Limited anti-inflammatory effects":"neutral"===l?"No significant inflammatory impact":"Not assessed"})]})]}),Object.keys(i).length>0&&(0,c.jsxs)("div",{className:"functional-compounds",children:[(0,c.jsx)("h5",{children:"\ud83e\uddec Functional Compounds"}),(0,c.jsx)("div",{className:"compounds-grid",children:Object.entries(i).map((e=>{let[t,a]=e;return(0,c.jsxs)("div",{className:"compound-item",children:[(0,c.jsx)("span",{className:"compound-name",children:t.replace(/_/g," ")}),(0,c.jsxs)("span",{className:"compound-level level-".concat(a),children:[" ",a]})]},t)}))})]}),n.length>0&&(0,c.jsxs)("div",{className:"benefits-list",children:[(0,c.jsx)("h5",{children:"\u2728 Benefits for Long COVID Recovery"}),(0,c.jsx)("ul",{children:n.map(((e,t)=>(0,c.jsx)("li",{children:e},t)))})]}),s.length>0&&(0,c.jsxs)("div",{className:"cautions-list",children:[(0,c.jsx)("h5",{children:"\u26a0\ufe0f Important Considerations"}),(0,c.jsx)("ul",{children:s.map(((e,t)=>(0,c.jsx)("li",{children:e},t)))})]})]})}return(0,c.jsxs)("div",{className:"no-food-info",children:[(0,c.jsx)("div",{className:"no-data-icon",children:"\ud83d\udcca"}),(0,c.jsx)("h4",{children:"No Long COVID Data Available"}),(0,c.jsx)("p",{children:"This food doesn't have specific Long COVID information in our database yet."}),(0,c.jsx)("p",{children:"Consider general anti-inflammatory principles:"}),(0,c.jsxs)("ul",{className:"general-tips",children:[(0,c.jsx)("li",{children:"Choose whole, unprocessed versions when possible"}),(0,c.jsx)("li",{children:"Pay attention to how it affects your symptoms"}),(0,c.jsx)("li",{children:"Consider portion sizes and frequency"}),(0,c.jsx)("li",{children:"Pair with known anti-inflammatory foods"})]})]})},pe=e=>{let{selectedFood:t,selectedMeal:a,foodLog:n=[],isSearching:s=!1,searchTerm:i=""}=e;return t&&a?(0,c.jsxs)("div",{className:"long-covid-side-panel",children:[(0,c.jsx)("h3",{children:"\ud83e\udda0 Long COVID Nutrition Guide"}),(0,c.jsxs)("div",{className:"selected-food-analysis",children:[(0,c.jsx)(ge,{foodName:t,mealData:a}),(0,c.jsx)("div",{className:"back-to-guide",children:(0,c.jsx)("p",{className:"guide-hint",children:(0,c.jsx)("em",{children:"Clear selection to see the full nutrition guide"})})})]})]}):s&&i.length>=2?(0,c.jsxs)("div",{className:"long-covid-side-panel",children:[(0,c.jsx)("h3",{children:"\ud83e\udda0 Long COVID Nutrition Guide"}),(0,c.jsx)("div",{className:"search-status",children:(0,c.jsx)("p",{className:"search-hint",children:(0,c.jsxs)("em",{children:['Searching for "',i,'"... Select a food above to see its specific analysis.']})})}),(0,c.jsx)("div",{className:"nutrition-categories",children:(0,c.jsxs)("div",{className:"category-section beneficial",children:[(0,c.jsx)("h4",{children:"\u2705 Quick Anti-Inflammatory Guide"}),(0,c.jsx)("p",{children:"Focus on omega-3 rich fish, berries, leafy greens, and anti-inflammatory spices."})]})})]}):(0,c.jsxs)("div",{className:"long-covid-side-panel",children:[(0,c.jsx)("h3",{children:"\ud83e\udda0 Long COVID Nutrition Guide"}),(0,c.jsxs)("div",{className:"nutrition-categories",children:[(0,c.jsxs)("div",{className:"category-section beneficial",children:[(0,c.jsx)("h4",{children:"\u2705 Anti-Inflammatory Foods"}),(0,c.jsxs)("ul",{children:[(0,c.jsxs)("li",{children:[(0,c.jsx)("strong",{children:"Fatty Fish:"})," Salmon, mackerel, sardines (omega-3s)"]}),(0,c.jsxs)("li",{children:[(0,c.jsx)("strong",{children:"Berries:"})," Blueberries, strawberries (antioxidants)"]}),(0,c.jsxs)("li",{children:[(0,c.jsx)("strong",{children:"Leafy Greens:"})," Spinach, kale (vitamins, minerals)"]}),(0,c.jsxs)("li",{children:[(0,c.jsx)("strong",{children:"Nuts:"})," Walnuts, almonds (healthy fats)"]}),(0,c.jsxs)("li",{children:[(0,c.jsx)("strong",{children:"Turmeric:"})," Contains curcumin (anti-inflammatory)"]}),(0,c.jsxs)("li",{children:[(0,c.jsx)("strong",{children:"Ginger:"})," Natural anti-inflammatory"]}),(0,c.jsxs)("li",{children:[(0,c.jsx)("strong",{children:"Green Tea:"})," Polyphenols reduce inflammation"]})]})]}),(0,c.jsxs)("div",{className:"category-section neutral",children:[(0,c.jsx)("h4",{children:"\u2139\ufe0f Recommended Foods"}),(0,c.jsxs)("ul",{children:[(0,c.jsxs)("li",{children:[(0,c.jsx)("strong",{children:"Whole Grains:"})," Oats, quinoa, brown rice"]}),(0,c.jsxs)("li",{children:[(0,c.jsx)("strong",{children:"Lean Proteins:"})," Chicken, turkey, legumes"]}),(0,c.jsxs)("li",{children:[(0,c.jsx)("strong",{children:"Citrus Fruits:"})," High in vitamin C"]}),(0,c.jsxs)("li",{children:[(0,c.jsx)("strong",{children:"Olive Oil:"})," Monounsaturated fats"]}),(0,c.jsxs)("li",{children:[(0,c.jsx)("strong",{children:"Garlic & Onions:"})," Immune support"]})]})]}),(0,c.jsxs)("div",{className:"category-section caution",children:[(0,c.jsx)("h4",{children:"\u26a0\ufe0f Foods to Limit"}),(0,c.jsxs)("ul",{children:[(0,c.jsxs)("li",{children:[(0,c.jsx)("strong",{children:"Processed Foods:"})," High in inflammation-promoting ingredients"]}),(0,c.jsxs)("li",{children:[(0,c.jsx)("strong",{children:"Refined Sugars:"})," Can worsen inflammation"]}),(0,c.jsxs)("li",{children:[(0,c.jsx)("strong",{children:"Red/Processed Meat:"})," May increase inflammatory markers"]}),(0,c.jsxs)("li",{children:[(0,c.jsx)("strong",{children:"Trans Fats:"})," Found in margarine, processed foods"]}),(0,c.jsxs)("li",{children:[(0,c.jsx)("strong",{children:"Refined Carbs:"})," White bread, pastries"]}),(0,c.jsxs)("li",{children:[(0,c.jsx)("strong",{children:"Fried Foods:"})," High in inflammatory compounds"]})]})]})]}),(0,c.jsxs)("div",{className:"additional-tips",children:[(0,c.jsx)("h4",{children:"\ud83d\udca1 General Tips"}),(0,c.jsxs)("ul",{children:[(0,c.jsx)("li",{children:"Stay well hydrated (8+ glasses water daily)"}),(0,c.jsx)("li",{children:"Consider vitamin D supplementation"}),(0,c.jsx)("li",{children:"Eat regular, smaller meals to maintain energy"}),(0,c.jsx)("li",{children:"Focus on nutrient-dense, whole foods"}),(0,c.jsx)("li",{children:"Limit alcohol and caffeine if they worsen symptoms"})]})]})]})},fe=e=>{const t=e.toLowerCase();return["salmon","mackerel","sardines","tuna","trout","blueberries","strawberries","raspberries","blackberries","spinach","kale","broccoli","brussels sprouts","walnuts","almonds","chia seeds","flax seeds","turmeric","ginger","garlic","onion","olive oil","avocado","sweet potato","green tea","dark chocolate"].some((e=>t.includes(e)))?"beneficial":["processed meat","bacon","sausage","hot dog","french fries","fried chicken","fried","white bread","white rice","pastry","candy","soda","sugar","margarine","ice cream","chips"].some((e=>t.includes(e)))?"caution":"neutral"},ve=e=>{const t=e.time,a=t.match(/(\d+):/),n=a?parseInt(a[1],10):12,s=t.toLowerCase().includes("pm");let i=n;s&&12!==n&&(i+=12),s||12!==n||(i=0);const o=.2*(parseFloat(e.protein)||0),l=.1*(parseFloat(e.carbs)||0),r=.15*(parseFloat(e.fat)||0);let c=1;i<6||i>20?c=.7:i>=7&&i<=10?c=1.2:i>=17&&i<=19&&(c=.9);const d={Breakfast:1.3,"Morning Snack":.9,Lunch:1.1,"Afternoon Snack":.8,Dinner:.9,"Late Night Snack":.6,Snack:.8}[e.mealType]||1;let m=Math.min(100,10*(o+l+r))*c*d;if(e.longCovidAdjust&&null!==b&&void 0!==b&&b.hasLongCovid){m*={mild:.95,moderate:.85,severe:.75,"very severe":.65}[b.longCovidSeverity]||.85,e.longCovidBenefits&&e.longCovidBenefits.length>0&&(m*=1.1),e.longCovidCautions&&e.longCovidCautions.length>0&&(m*=.9)}return Math.min(100,Math.max(0,m))},xe=((e,t)=>{const[a,n]=(0,s.useState)(e);return(0,s.useEffect)((()=>{const a=setTimeout((()=>{n(e)}),t);return()=>clearTimeout(a)}),[e,t]),a})(S,300),ye=(0,s.useCallback)((async()=>{const e=S.toLowerCase().trim();if(e.length<2)return void F([]);if(ce[e])return void F(ce[e]);const t=(e,t)=>{const a=(e.name||"").toLowerCase(),n=(e.category||"").toLowerCase(),s=(e.description||"").toLowerCase();let i=0;a===t?i+=1:a.startsWith(t)?i+=.8:a.includes(t)&&(i+=.6),n.includes(t)&&(i+=.3),s.includes(t)&&(i+=.2);const o=a.split(" "),l=t.split(" ");let r=0;return l.forEach((e=>{o.forEach((t=>{t.startsWith(e)&&r++}))})),i+=r/Math.max(l.length,1)*.4,i},s=(e,a)=>a.filter((t=>{if(!t.name)return!1;const a=t.name.toLowerCase(),n=(t.category||"").toLowerCase(),s=(t.description||"").toLowerCase(),i=(t.longCovidBenefits||[]).join(" ").toLowerCase();return a.includes(e)||a.startsWith(e)||n.includes(e)||s.includes(e)||i.includes(e)||a.split(" ").some((t=>t.startsWith(e)))})).map((a=>(0,n.A)((0,n.A)({},a),{},{searchMethod:"javascript",searchScore:t(a,e)}))).sort(((t,a)=>{const n=(t.name||"").toLowerCase(),s=(a.name||"").toLowerCase();return n===e&&s!==e?-1:s===e&&n!==e?1:n.startsWith(e)&&!s.startsWith(e)?-1:s.startsWith(e)&&!n.startsWith(e)?1:(a.searchScore||0)-(t.searchScore||0)})).slice(0,15);try{console.log('\ud83d\udd0d Enhanced search for: "'.concat(e,'"'));let t=a;if(0===t.length){console.log("\ud83d\udce5 Fetching food database...");const e=(0,o.P)((0,o.rJ)(l.db,"meals"),(0,o.AB)(1e3));if(t=(await(0,o.GG)(e)).docs.map((e=>(0,n.A)({id:e.id},e.data()))),r(t),console.log("\ud83d\udcca Loaded ".concat(t.length," foods into cache")),window.pyodideReady&&!u)try{console.log("\ud83c\udfd7\ufe0f Building search index...");const e=await window.pyodide.runPython("\n              result = search_engine.build_index('".concat(JSON.stringify(t).replace(/'/g,"\\'"),"')\n              result\n            "));h(!0),window.searchIndexBuilt=!0,console.log("\u2705 Search index built:",e)}catch(Y){console.error("\u274c Error building Python index:",Y)}}let i=[];if(window.pyodideReady&&u)try{console.log("\ud83d\ude80 Using AI-powered search");const t=await window.pyodide.runPython('\n            results = search_engine.search("'.concat(e.replace(/"/g,'\\"'),'", 15)\n            json.dumps(results)\n          '));i=JSON.parse(t),console.log("\ud83c\udfaf AI search returned ".concat(i.length," results")),i=i.map((e=>(0,n.A)((0,n.A)({},e),{},{searchMethod:"ai",searchScore:e.search_score||0})))}catch(Y){console.error("\u274c Python search failed, using fallback:",Y),i=s(e,t)}else console.log("\ud83d\udcdd Using fallback JavaScript search"),i=s(e,t);de((t=>(0,n.A)((0,n.A)({},t),{},{[e]:i}))),F(i)}catch(i){console.error("\u274c Search error:",i),F([])}}),[S,ce,a,u]);(0,s.useEffect)((()=>{const e=()=>{window.pyodideReady?m("ready"):window.pyodide?m("loading"):m("unavailable")};e();const t=()=>{m("ready"),console.log("\ud83c\udf89 Pyodide ready event received")},a=()=>{m("unavailable"),console.log("\u26a0\ufe0f Pyodide error event received")};window.addEventListener("pyodideReady",t),window.addEventListener("pyodideError",a);const n=setInterval(e,2e3);return()=>{window.removeEventListener("pyodideReady",t),window.removeEventListener("pyodideError",a),clearInterval(n)}}),[]),(0,s.useEffect)((()=>{xe.length<2?F([]):ye()}),[xe,ye]);const je=e=>{var t,a,n,s,i;I(e),D(e.name),F([]),p(!1);const o=(null===(t=e.nutrients)||void 0===t?void 0:t.per100g)||{};O({name:e.name,protein:(null===(a=o.protein)||void 0===a?void 0:a.value)||"",carbs:(null===(n=o.carbs)||void 0===n?void 0:n.value)||"",fat:(null===(s=o.fat)||void 0===s?void 0:s.value)||"",calories:(null===(i=o.calories)||void 0===i?void 0:i.value)||"",serving:100,micronutrients:o,longCovidBenefits:e.longCovidBenefits||[],longCovidCautions:e.longCovidCautions||[],longCovidRelevance:e.longCovidRelevance||{}});const l=document.querySelector(".search-input");l&&l.blur()},be=e=>{const{name:t,value:a}=e.target;"serving"===t?(O((e=>(0,n.A)((0,n.A)({},e),{},{[t]:a}))),(e=>{var t;if(!L||null===(t=L.nutrients)||void 0===t||!t.per100g)return;const a=parseFloat(e)/100;isNaN(a)||O((e=>{var t,s,i,o;const l=(0,n.A)({},e),r=L.nutrients.per100g;return l.protein=((null===(t=r.protein)||void 0===t?void 0:t.value)*a).toFixed(1),l.carbs=((null===(s=r.carbs)||void 0===s?void 0:s.value)*a).toFixed(1),l.fat=((null===(i=r.fat)||void 0===i?void 0:i.value)*a).toFixed(1),l.calories=((null===(o=r.calories)||void 0===o?void 0:o.value)*a).toFixed(0),l.micronutrients={},Object.entries(r).forEach((e=>{let[t,s]=e;["protein","carbs","fat","calories","name","unit"].includes(t)||(l.micronutrients[t]=(0,n.A)((0,n.A)({},s),{},{value:(s.value*a).toFixed(1)}))})),l}))})(a)):O((e=>(0,n.A)((0,n.A)({},e),{},{[t]:a})))},Ne=(0,s.useCallback)((async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if(f&&f.id){K(!0),1===e&&Z([]),ee("");try{const t=(0,o.P)((0,o.rJ)(l.db,"users",f.id,"food_journal"),(0,o.My)("date","desc"),(0,o.My)("createdAt","desc"),(0,o.AB)(20*e)),a=(await(0,o.GG)(t)).docs.map((e=>(0,n.A)({id:e.id},e.data())));Z(a),ae(e)}catch(t){console.error("Error fetching food log:",t),ee("Failed to load journal: ".concat(t.message))}finally{K(!1)}}}),[f]);(0,s.useEffect)((()=>{"Food Journal"===k&&f&&Ne(1)}),[k,f,Ne]);const Ce=()=>{t("/dashboard")};return C?(0,c.jsx)("div",{className:"food-tracker-container",children:(0,c.jsx)("div",{className:"loading-indicator",children:"Loading..."})}):f?(0,c.jsxs)("div",{className:"food-tracker-container",children:[(0,c.jsxs)("div",{className:"bg-animation",children:[(0,c.jsx)("div",{className:"card-glow"}),(0,c.jsx)("div",{className:"floating-shape shape-1"}),(0,c.jsx)("div",{className:"floating-shape shape-2"}),(0,c.jsx)("div",{className:"floating-shape shape-3"}),(0,c.jsx)("div",{className:"floating-shape shape-4"}),(0,c.jsx)("div",{className:"floating-shape shape-5"}),(0,c.jsx)("div",{className:"floating-shape shape-6"})]}),(0,c.jsxs)("div",{className:"food-tracker-content",children:[ie&&(0,c.jsx)(me,{entryId:ie,entryName:(null===(e=X.find((e=>e.id===ie)))||void 0===e?void 0:e.name)||"Unknown",onConfirm:async e=>{if(f&&e){re(!0),ee("");try{await(0,o.kd)((0,o.H9)(l.db,"users",f.id,"food_journal",e)),Z((t=>t.filter((t=>t.id!==e)))),J("Food entry deleted successfully!"),setTimeout((()=>J("")),3e3)}catch(t){console.error("Error deleting entry:",t),ee("Failed to delete entry: ".concat(t.message))}finally{re(!1),oe(null)}}},onCancel:()=>oe(null)}),(0,c.jsxs)("div",{className:"tracker-header",children:[(0,c.jsx)("button",{onClick:Ce,className:"back-button",children:"\u2190 Back to Dashboard"}),(0,c.jsx)("button",{onClick:async()=>{console.log("Logout clicked - starting complete logout process");try{console.log("Clearing localStorage userData"),localStorage.removeItem("userData"),sessionStorage.clear(),console.log("Cleared sessionStorage"),v(null),w(!1),console.log("Complete logout finished, navigating to login..."),t("/login",{replace:!0})}catch(Y){console.error("Error during logout:",Y),localStorage.removeItem("userData"),sessionStorage.clear(),v(null),t("/login",{replace:!0})}},className:"logout-btn",children:"Logout"})]}),(0,c.jsx)("h2",{children:"\ud83c\udf7d\ufe0f Smart Meal Tracker"}),(0,c.jsxs)("div",{className:"ai-status-banner ".concat(d),children:["ready"===d&&(0,c.jsxs)("div",{className:"ai-ready",children:["\ud83d\ude80 ",(0,c.jsx)("strong",{children:"AI Search Enabled:"})," Advanced food matching with intelligent recommendations"]}),"loading"===d&&(0,c.jsxs)("div",{className:"ai-loading",children:["\ud83d\udd04 ",(0,c.jsx)("strong",{children:"Loading AI:"})," Preparing enhanced search capabilities..."]}),"unavailable"===d&&(0,c.jsxs)("div",{className:"ai-fallback",children:["\ud83d\udcdd ",(0,c.jsx)("strong",{children:"Basic Search:"})," AI unavailable, using standard search"]})]}),(0,c.jsx)("div",{className:"food-tabs",children:j.map((e=>(0,c.jsx)("button",{className:"food-tab".concat(k===e?" active":""),onClick:()=>A(e),children:e},e)))}),"Add Food"===k&&(0,c.jsxs)("div",{className:"food-form-section",children:[(0,c.jsxs)("div",{className:"food-form-left",children:[ne&&(0,c.jsxs)("div",{className:"edit-mode-banner",children:[(0,c.jsxs)("div",{className:"edit-indicator",children:[(0,c.jsx)("span",{className:"edit-icon",children:"\u270f\ufe0f"}),(0,c.jsxs)("span",{className:"edit-text",children:[(0,c.jsx)("strong",{children:"Editing:"})," ",ne.name]})]}),(0,c.jsx)("button",{className:"cancel-edit-btn",onClick:()=>{se(null),O({}),I(null),D(""),J(""),q("")},type:"button",children:"Cancel Edit"})]}),(0,c.jsxs)("div",{className:"form-group long-covid-checkbox-group",children:[(0,c.jsxs)("label",{className:"long-covid-checkbox-label",children:[(0,c.jsx)("input",{type:"checkbox",checked:U,onChange:e=>V(e.target.checked),className:"long-covid-checkbox"}),(0,c.jsx)("span",{className:"checkbox-text",children:"I have Long COVID - Show food recommendations and adjustments"})]}),U&&(0,c.jsx)("div",{className:"long-covid-info-banner",children:(0,c.jsxs)("p",{children:["\ud83d\udd2c ",(0,c.jsx)("strong",{children:"Long COVID Mode:"})," Food recommendations will be adjusted to focus on anti-inflammatory options that may help manage symptoms and support recovery."]})})]}),(0,c.jsxs)("div",{className:"form-group search-group",children:[(0,c.jsx)("label",{children:"Search Food"}),(0,c.jsxs)("div",{className:"search-input-container ".concat(g?"search-focused":""),children:[(0,c.jsx)("input",{type:"text",value:S,onChange:e=>{D(e.target.value),I(null)},onFocus:()=>p(!0),onBlur:()=>{setTimeout((()=>{p(!1),F([])}),200)},placeholder:"ready"===d?"\ud83e\udde0 AI-powered search ready...":"loading"===d?"\ud83d\udd04 Loading AI search...":"Search foods...",autoComplete:"off",className:"search-input enhanced-search"}),(0,c.jsxs)("div",{className:"search-status ".concat(d),children:["ready"===d&&u&&(0,c.jsx)("span",{className:"status-ready",children:"\ud83d\ude80 AI Search Active"}),"ready"===d&&!u&&(0,c.jsx)("span",{className:"status-indexing",children:"\u26a1 Building AI Index..."}),"loading"===d&&(0,c.jsx)("span",{className:"status-loading",children:"\ud83d\udd04 Loading AI..."}),"unavailable"===d&&(0,c.jsx)("span",{className:"status-basic",children:"\ud83d\udcdd Basic Search"}),E.length>0&&(0,c.jsxs)("span",{className:"result-count",children:["(",E.length," results)"]})]})]}),E.length>0&&g&&(0,c.jsx)("ul",{className:"suggestions-list enhanced",children:E.map(((e,t)=>(0,c.jsxs)("li",{onClick:()=>je(e),children:[(0,c.jsxs)("div",{className:"suggestion-main",children:[(0,c.jsx)("div",{className:"suggestion-name",children:e.name}),e.category&&(0,c.jsx)("div",{className:"suggestion-category",children:e.category}),(0,c.jsxs)("div",{className:"suggestion-meta",children:[e.searchScore&&(0,c.jsxs)("span",{className:"search-score",children:[(100*e.searchScore).toFixed(0),"% match"]}),"ai"===e.searchMethod&&(0,c.jsx)("span",{className:"ai-badge",children:"\ud83e\udde0 AI"}),"javascript"===e.searchMethod&&(0,c.jsx)("span",{className:"js-badge",children:"JS"}),e.match_type&&(0,c.jsx)("span",{className:"match-type",children:e.match_type})]})]}),(0,c.jsx)("div",{className:"suggestion-indicators",children:U&&(0,c.jsx)("span",{className:"covid-indicator ".concat(fe(e.name)),children:"beneficial"===fe(e.name)?"\u2705":"caution"===fe(e.name)?"\u26a0\ufe0f":"\u2139\ufe0f"})})]},e.id||t)))})]}),(0,c.jsxs)("div",{className:"form-row",children:[(0,c.jsxs)("div",{className:"form-group",children:[(0,c.jsx)("input",{name:"protein",value:M.protein||"",onChange:be,type:"number",step:"0.1",placeholder:" "}),(0,c.jsx)("label",{children:"Protein (g)"})]}),(0,c.jsxs)("div",{className:"form-group",children:[(0,c.jsx)("input",{name:"carbs",value:M.carbs||"",onChange:be,type:"number",step:"0.1",placeholder:" "}),(0,c.jsx)("label",{children:"Carbs (g)"})]}),(0,c.jsxs)("div",{className:"form-group",children:[(0,c.jsx)("input",{name:"fat",value:M.fat||"",onChange:be,type:"number",step:"0.1",placeholder:" "}),(0,c.jsx)("label",{children:"Fat (g)"})]}),(0,c.jsxs)("div",{className:"form-group",children:[(0,c.jsx)("input",{name:"serving",value:M.serving||"",onChange:be,type:"number",step:"1",className:"serving-input",placeholder:" "}),(0,c.jsx)("label",{children:"Serving (g)"})]})]}),(0,c.jsxs)("div",{className:"form-row",children:[(0,c.jsxs)("div",{className:"form-group",children:[(0,c.jsx)("label",{htmlFor:"meal-type",children:"Meal Type"}),(0,c.jsx)("select",{id:"meal-type",value:_,onChange:e=>T(e.target.value),children:y.map((e=>(0,c.jsx)("option",{value:e,children:e},e)))})]}),(0,c.jsxs)("div",{className:"form-group",children:[(0,c.jsx)("input",{type:"time",value:(e=>{if(!e)return"";const[t,a]=e.split(" ");if(!t||!a)return e;let[n,s]=t.split(":");return"12"===n&&(n="00"),"PM"===a&&(n=String(parseInt(n,10)+12)),n=String(n),"".concat(n.padStart(2,"0"),":").concat(s)})(B),onChange:e=>{const t=e.target.value;if(!t)return;const a=new Date("2000-01-01T".concat(t)).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});P(a)},placeholder:" "}),(0,c.jsx)("label",{children:"Time"})]}),(0,c.jsxs)("div",{className:"form-group",children:[(0,c.jsx)("input",{type:"date",value:R,onChange:e=>z(e.target.value),placeholder:" "}),(0,c.jsx)("label",{children:"Date"})]})]}),(0,c.jsxs)("div",{className:"form-group",children:[(0,c.jsx)("input",{name:"calories",value:M.calories||"",onChange:be,type:"number",step:"1",placeholder:" "}),(0,c.jsx)("label",{children:"Calories"})]}),(0,c.jsxs)("div",{className:"form-group",children:[(0,c.jsx)("button",{className:"submit-button ".concat(ne?"update-mode":""),onClick:async()=>{if(f&&f.id){H(!0),q(""),J("");try{if(!M.name)throw new Error("Food name is required");const e={name:M.name,protein:parseFloat(M.protein)||0,carbs:parseFloat(M.carbs)||0,fat:parseFloat(M.fat)||0,calories:parseFloat(M.calories)||0,serving:parseFloat(M.serving)||100,micronutrients:M.micronutrients||{},mealType:_,time:B,date:R,longCovidAdjust:U,longCovidBenefits:M.longCovidBenefits||[],longCovidCautions:M.longCovidCautions||[],longCovidRelevance:M.longCovidRelevance||{},mealId:(null===L||void 0===L?void 0:L.id)||null};if(e.metabolicEfficiency=ve(e),ne)await(0,o.mZ)((0,o.H9)(l.db,"users",f.id,"food_journal",ne.id),(0,n.A)((0,n.A)({},e),{},{updatedAt:o.Dc.now()})),Z((t=>t.map((t=>t.id===ne.id?(0,n.A)((0,n.A)((0,n.A)({},t),e),{},{id:ne.id}):t)))),J("Food entry updated successfully!"),se(null);else{e.createdAt=o.Dc.now();const t=await(0,o.gS)((0,o.rJ)(l.db,"users",f.id,"food_journal"),e),a=(0,n.A)({id:t.id},e);Z((e=>[a,...e])),J("Food logged successfully!")}O({}),I(null),D("")}catch(e){console.error("Error logging food:",e),q("Failed to ".concat(ne?"update":"log"," food: ").concat(e.message))}finally{H(!1)}}else q("Please log in to save your meals")},disabled:G||!M.name,children:G?ne?"Updating...":"Logging...":ne?"Update Food":"Log Food"}),W&&(0,c.jsx)("div",{className:"success-message",children:W}),Y&&(0,c.jsx)("div",{className:"error-message",children:Y})]})]}),(0,c.jsxs)("div",{className:"food-form-right",children:[U&&(0,c.jsx)(pe,{selectedFood:M.name,selectedMeal:L,foodLog:X,isSearching:S.length>=2&&!L,searchTerm:S}),!U&&(0,c.jsxs)("div",{className:"general-nutrition-info",children:[(0,c.jsx)("h3",{children:"\ud83d\udcca Nutrition Tips"}),(0,c.jsx)("p",{children:"Enable Long COVID mode above to get personalized food recommendations and anti-inflammatory guidance."}),"ready"===d&&(0,c.jsx)("div",{className:"ai-tip",children:(0,c.jsxs)("p",{children:["\ud83d\udca1 ",(0,c.jsx)("strong",{children:"AI Tip:"})," The search above uses machine learning to find the most relevant foods for your queries!"]})})]})]})]}),"Food Journal"===k&&(0,c.jsxs)("div",{className:"food-journal-section",children:[(0,c.jsxs)("div",{className:"journal-header",children:[(0,c.jsx)("h3",{children:"Your Food Journal"}),(0,c.jsx)("button",{className:"refresh-button",onClick:()=>Ne(1),disabled:Q,children:Q?"Loading...":"Refresh"})]}),$&&(0,c.jsx)("div",{className:"error-message",children:$}),W&&(0,c.jsx)("div",{className:"success-message",children:W}),Q&&0===X.length?(0,c.jsx)("div",{className:"loading-indicator",children:"Loading your food journal..."}):0===X.length?(0,c.jsxs)("div",{className:"empty-state",children:[(0,c.jsx)("p",{children:"No entries found in your food journal."}),(0,c.jsx)("p",{children:'Start by adding a meal in the "Add Food" tab!'})]}):(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("div",{className:"journal-summary",children:(0,c.jsxs)("p",{children:["Showing ",X.length," meal entries"]})}),(0,c.jsx)("div",{className:"journal-table-container",children:(()=>{const e=e=>{if(!e)return"12:00";const[t,a]=e.split(" ");if(!t||!a)return e;let[n,s]=t.split(":"),i=parseInt(n,10);return"AM"===a.toUpperCase()?12===i&&(i=0):"PM"===a.toUpperCase()&&12!==i&&(i+=12),"".concat(i.toString().padStart(2,"0"),":").concat(s)},t=[...X].sort(((t,a)=>{if(t.date!==a.date)return a.date.localeCompare(t.date);const n=e(t.time),s=e(a.time);return n.localeCompare(s)})),a={};t.forEach((e=>{a[e.date]||(a[e.date]=[]),a[e.date].push(e)}));const n=e=>{try{const[t,a,n]=e.split("-"),s=new Date(parseInt(t),parseInt(a)-1,parseInt(n)),i=new Date,o=new Date;o.setDate(i.getDate()-1);const l={weekday:"long",year:"numeric",month:"long",day:"numeric"},r=s.toLocaleDateString("en-US",l);return e===i.toISOString().split("T")[0]?"Today - ".concat(r):e===o.toISOString().split("T")[0]?"Yesterday - ".concat(r):r}catch(Y){return e}},s=e=>{switch(e){case"Breakfast":return"B";case"Morning Snack":return"MS";case"Lunch":return"L";case"Afternoon Snack":return"AS";case"Dinner":return"D";case"Late Night Snack":return"LN";case"Snack":return"S";default:return e.charAt(0)}};return(0,c.jsx)("div",{className:"journal-by-day",children:Object.entries(a).map((e=>{let[t,a]=e;const i=(e=>e.reduce(((e,t)=>(e.calories+=parseFloat(t.calories)||0,e.protein+=parseFloat(t.protein)||0,e.carbs+=parseFloat(t.carbs)||0,e.fat+=parseFloat(t.fat)||0,e.meals+=1,e)),{calories:0,protein:0,carbs:0,fat:0,meals:0}))(a);return(0,c.jsxs)("div",{className:"day-group",children:[(0,c.jsxs)("div",{className:"day-header",children:[(0,c.jsxs)("div",{className:"day-header-left",children:[(0,c.jsx)("h4",{className:"day-title",children:n(t)}),(0,c.jsxs)("span",{className:"day-meal-count",children:[i.meals," meal",1!==i.meals?"s":""]})]}),(0,c.jsxs)("div",{className:"day-totals",children:[(0,c.jsxs)("div",{className:"day-total-item",children:[(0,c.jsx)("span",{className:"total-label",children:"Total:"}),(0,c.jsxs)("span",{className:"total-value",children:[Math.round(i.calories)," cal"]})]}),(0,c.jsxs)("div",{className:"day-total-macros",children:[(0,c.jsxs)("span",{className:"macro-total",children:["P: ",i.protein.toFixed(1),"g"]}),(0,c.jsxs)("span",{className:"macro-total",children:["C: ",i.carbs.toFixed(1),"g"]}),(0,c.jsxs)("span",{className:"macro-total",children:["F: ",i.fat.toFixed(1),"g"]})]})]})]}),(0,c.jsxs)("table",{className:"food-log-table day-table",children:[(0,c.jsx)("thead",{children:(0,c.jsxs)("tr",{children:[(0,c.jsx)("th",{className:"time-col",children:"Time"}),(0,c.jsx)("th",{className:"meal-type-col",children:"Meal"}),(0,c.jsx)("th",{className:"food-col",children:"Food"}),(0,c.jsx)("th",{className:"serving-col",children:"Serving"}),(0,c.jsx)("th",{className:"macro-col",children:"P"}),(0,c.jsx)("th",{className:"macro-col",children:"C"}),(0,c.jsx)("th",{className:"macro-col",children:"F"}),(0,c.jsx)("th",{className:"calories-col",children:"Cal"}),(0,c.jsx)("th",{className:"efficiency-col",children:"Eff%"}),(0,c.jsx)("th",{className:"actions-col",children:"Actions"})]})}),(0,c.jsx)("tbody",{children:a.map(((e,t)=>(0,c.jsxs)("tr",{className:"meal-row ".concat(0===t?"first-meal":""),children:[(0,c.jsx)("td",{className:"time-cell",children:(0,c.jsx)("span",{className:"meal-time",children:e.time.replace(":00","").replace(" ","")})}),(0,c.jsx)("td",{className:"meal-type-cell",children:(0,c.jsx)("span",{className:"meal-badge ".concat((e.mealType||"unknown").trim().toLowerCase().replace(/\s+/g,"-")),children:s(e.mealType||"Unknown")})}),(0,c.jsx)("td",{className:"food-cell",title:e.name,children:(0,c.jsx)("span",{className:"food-name",children:e.name.length>25?"".concat(e.name.substring(0,25),"..."):e.name})}),(0,c.jsxs)("td",{className:"serving-cell",children:[e.serving||"0","g"]}),(0,c.jsx)("td",{className:"macro-cell",children:"number"===typeof e.protein?e.protein.toFixed(1):e.protein||"0"}),(0,c.jsx)("td",{className:"macro-cell",children:"number"===typeof e.carbs?e.carbs.toFixed(1):e.carbs||"0"}),(0,c.jsx)("td",{className:"macro-cell",children:"number"===typeof e.fat?e.fat.toFixed(1):e.fat||"0"}),(0,c.jsx)("td",{className:"calories-cell",children:(0,c.jsx)("strong",{children:e.calories||"0"})}),(0,c.jsx)("td",{className:"efficiency-cell",children:(0,c.jsx)("span",{className:"efficiency-badge ".concat("number"===typeof e.metabolicEfficiency?e.metabolicEfficiency>=80?"high":e.metabolicEfficiency>=60?"medium":"low":"unknown"),children:"number"===typeof e.metabolicEfficiency?e.metabolicEfficiency.toFixed(0):"N/A"})}),(0,c.jsx)("td",{className:"actions-cell",children:(0,c.jsxs)("div",{className:"action-buttons compact",children:[(0,c.jsx)("button",{className:"edit-btn compact",onClick:()=>(e=>{O({name:e.name,protein:e.protein,carbs:e.carbs,fat:e.fat,calories:e.calories,serving:e.serving||100,micronutrients:e.micronutrients||{},longCovidBenefits:e.longCovidBenefits||[],longCovidCautions:e.longCovidCautions||[],longCovidRelevance:e.longCovidRelevance||{}}),T(e.mealType),P(e.time),z(e.date),V(e.longCovidAdjust||!1),D(e.name),se(e),A("Add Food")})(e),title:"Edit entry",children:"\u270f\ufe0f"}),(0,c.jsx)("button",{className:"delete-btn compact",onClick:()=>oe(e.id),title:"Delete entry",children:"\ud83d\uddd1\ufe0f"})]})})]},e.id)))})]})]},t)}))})})()}),X.length>=20*te&&(0,c.jsx)("div",{className:"load-more-container",children:(0,c.jsx)("button",{className:"load-more-button",onClick:()=>Ne(te+1),disabled:Q,children:Q?"Loading...":"Load More Entries"})})]})]}),"Analysis"===k&&(0,c.jsx)(x,{foodLog:X,userProfile:b})]})]}):(0,c.jsx)("div",{className:"food-tracker-container",children:(0,c.jsxs)("div",{className:"auth-required",children:[(0,c.jsx)("h2",{children:"Authentication Required"}),(0,c.jsx)("p",{children:"Please log in to use the food tracker."}),(0,c.jsx)("button",{onClick:Ce,className:"back-button",children:"Back to Dashboard"})]})})}}}]);
//# sourceMappingURL=924.2f627fac.chunk.js.map