"use strict";(self.webpackChunkenergy_balance=self.webpackChunkenergy_balance||[]).push([[924],{4924:(e,t,a)=>{a.r(t),a.d(t,{default:()=>w});var n=a(2555),s=a(5043),i=a(3216),o=a(5472),r=a(303),l=a(7523),c=a(579);const d=(e,t)=>{const a=e.time,n=a.match(/(\d+):/),s=n?parseInt(n[1],10):12,i=a.toLowerCase().includes("pm");let o=s;i&&12!==s&&(o+=12),i||12!==s||(o=0);const r=.2*(parseFloat(e.protein)||0),l=.1*(parseFloat(e.carbs)||0),c=.15*(parseFloat(e.fat)||0);let d=1;o<6||o>20?d=.7:o>=7&&o<=10?d=1.2:o>=17&&o<=19&&(d=.9);const m={Breakfast:1.3,"Morning Snack":.9,Lunch:1.1,"Afternoon Snack":.8,Dinner:.9,"Late Night Snack":.6}[e.mealType]||1;let u=Math.min(100,10*(r+l+c))*d*m;if(e.longCovidAdjust&&null!==t&&void 0!==t&&t.hasLongCovid){u*={mild:.95,moderate:.85,severe:.75,"very severe":.65}[null===(h=t.longCovidSeverity)||void 0===h?void 0:h.toLowerCase()]||.85,e.longCovidBenefits&&e.longCovidBenefits.length>0&&(u*=1.1),e.longCovidCautions&&e.longCovidCautions.length>0&&(u*=.9)}var h;return Math.min(100,Math.max(0,u))},m=e=>{const t=e.split("-");return new Date(parseInt(t[0]),parseInt(t[1])-1,parseInt(t[2]))},u=e=>{const t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),n=String(e.getDate()).padStart(2,"0");return"".concat(t,"-").concat(a,"-").concat(n)};console.log("Testing with sample data:");const h=((e,t)=>{console.log("=== DEBUGGING EFFICIENCY CALCULATION ==="),console.log("Input mealData:",e),console.log("Input userProfile:",t);const a=e.time;console.log("Time string:",a);const n=a.match(/(\d+):/),s=n?parseInt(n[1],10):12,i=a.toLowerCase().includes("pm");console.log("Parsed hour:",s,"isPM:",i);let o=s;i&&12!==s&&(o+=12),i||12!==s||(o=0),console.log("24-hour format:",o);const r=parseFloat(e.protein)||0,l=parseFloat(e.carbs)||0,c=parseFloat(e.fat)||0;console.log("Macros - Protein:",r,"Carbs:",l,"Fat:",c);const d=.2*r,m=.1*l,u=.15*c;console.log("Macro factors - Protein:",d,"Carbs:",m,"Fat:",u);let h=1;o<6||o>20?h=.7:o>=7&&o<=10?h=1.2:o>=17&&o<=19&&(h=.9),console.log("Time factor:",h);const g={Breakfast:1.3,"Morning Snack":.9,Lunch:1.1,"Afternoon Snack":.8,Dinner:.9,"Late Night Snack":.6,Snack:.8}[e.mealType]||1;console.log("Meal type:",e.mealType,"Factor:",g);const p=Math.min(100,10*(d+m+u));console.log("Macro balance:",p);let f=p*h*g;if(console.log("Base efficiency:",f),e.longCovidAdjust&&null!==t&&void 0!==t&&t.hasLongCovid){var v;console.log("Applying Long COVID adjustments...");const a={mild:.95,moderate:.85,severe:.75,"very severe":.65}[(null===(v=t.longCovidSeverity)||void 0===v?void 0:v.toLowerCase())||"moderate"]||.85;console.log("Severity factor:",a),f*=a,console.log("After severity adjustment:",f),e.longCovidBenefits&&e.longCovidBenefits.length>0&&(f*=1.1,console.log("After benefits boost:",f)),e.longCovidCautions&&e.longCovidCautions.length>0&&(f*=.9,console.log("After cautions reduction:",f))}const x=Math.min(100,Math.max(0,f));return console.log("Final efficiency:",x),console.log("=== END DEBUGGING ===\n"),x})({name:"Greek Yogurt with Berries",protein:20,carbs:35,fat:8,calories:320,mealType:"Breakfast",time:"8:00 AM",longCovidAdjust:!0,longCovidBenefits:["High protein for recovery","Probiotics for gut health"]},{hasLongCovid:!0,longCovidSeverity:"moderate"});function g(e){let{userData:t,userIntake:a={}}=e;const i=(0,s.useRef)(null),[o,r]=(0,s.useState)(null),d=(0,s.useCallback)((e=>{const t=(e,t)=>e&&t?e/Math.pow(t/100,2):null,a=(e=>{const{age:a,gender:n,weight:s,height:i,activity_level:o}=e;if(!a||!s||!i)return 2e3;let r;r="female"===n?10*s+6.25*i-5*a-161:10*s+6.25*i-5*a+5;let l=r*({sedentary:1.2,light:1.375,moderate:1.55,very:1.725,extreme:1.9}[o]||1.375);e.covid_condition&&(l*=1.07);const c=t(s,i);return c&&(c<18.5?l*=1.1:c>30&&(l*=.9)),Math.round(l)})(e),n=((e,a)=>{if(!e)return null;let n=.25,s=.45,i=.3;a.covid_condition&&(n=.3,s=.4,i=.3);const o=t(a.weight,a.height);if(o&&o<18.5&&(i=.35,s=.45,n=.2),o&&o>30&&(n=.35,s=.35,i=.3),a.age>65){n=Math.min(n+.05,.4);const e=1-n;s=e*(s/(s+i)),i=e*(i/(s+i))}return{protein:n,carbs:s,fat:i}})(a,e),s=(a*n.protein/4).toFixed(1),i=(a*n.carbs/4).toFixed(1),o=(a*n.fat/9).toFixed(1),r="Increased to support immune function and tissue repair",l="Focus on complex carbs with anti-inflammatory properties",c="Higher proportion of omega-3s recommended to reduce inflammation";return{protein:{value:parseFloat(s),covidNote:e.covid_condition?r:null},carbs:{value:parseFloat(i),covidNote:e.covid_condition?l:null},fat:{value:parseFloat(o),covidNote:e.covid_condition?c:null},calories:{value:a}}}),[]);return(0,s.useEffect)((()=>{if(t){const e=d(t);r(e)}}),[t,d]),(0,s.useEffect)((()=>{if(!i.current||!o||!a)return;l.Ltv(i.current).selectAll("*").remove();const e=40,s=180,r=60,c=70,d=700-c-s,m=350-e-r,u=l.Ltv(i.current).append("svg").attr("width",d+c+s).attr("height",m+e+r).append("g").attr("transform","translate(".concat(c,",").concat(e,")")),h=["protein","carbs","fat"],g=[(0,n.A)({name:"Current Intake"},a),{name:"Recommended",protein:o.protein.value,carbs:o.carbs.value,fat:o.fat.value}],p={protein:"#22c55e",carbs:"#3b82f6",fat:"#f59e0b"},f=l.WH().domain(g.map((e=>e.name))).range([0,d]).padding(.3),v=l.T9B(g,(e=>e.protein+e.carbs+e.fat)),x=l.m4Y().domain([0,1.1*v]).range([m,0]);u.append("g").attr("transform","translate(0,".concat(m,")")).call(l.l78(f)).selectAll("text").attr("font-size","12px").attr("font-weight",(e=>"Recommended"===e?"bold":"normal")),u.append("g").call(l.V4s(x).ticks(5)).selectAll("text").attr("font-size","12px"),u.append("text").attr("transform","rotate(-90)").attr("y",20-c).attr("x",-m/2).attr("font-size","14px").attr("text-anchor","middle").attr("fill","#666").text("Grams");const y=(new Date).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"});u.append("text").attr("x",d/2).attr("y",-e/2).attr("text-anchor","middle").attr("font-size","16px").attr("font-weight","bold").attr("fill","#333").text("Long COVID Macronutrient Analysis - ".concat(y)),g.forEach((e=>{let t=0;e.stackedData=h.map((a=>({nutrient:a,y0:t,y1:t+=e[a]||0})))}));const j=l.Ltv("body").append("div").attr("class","d3-tooltip").style("position","absolute").style("background-color","white").style("border","1px solid #ddd").style("border-radius","4px").style("padding","8px").style("font-size","12px").style("pointer-events","none").style("opacity",0).style("box-shadow","0 2px 4px rgba(0,0,0,0.1)").style("z-index",100);u.selectAll(".bar-group").data(g).join("g").attr("class","bar-group").attr("transform",(e=>"translate(".concat(f(e.name),",0)"))).selectAll("rect").data((e=>e.stackedData)).join("rect").attr("width",f.bandwidth()).attr("y",(e=>x(e.y1))).attr("height",(e=>x(e.y0)-x(e.y1))).attr("fill",(e=>p[e.nutrient])).attr("stroke","white").attr("stroke-width",1).on("mouseover",(function(e,t){const a=l.Ltv(this.parentNode).datum(),n=a[t.nutrient].toFixed(1),s=(a[t.nutrient]/(a.protein+a.carbs+a.fat)*100).toFixed(1),i="fat"===t.nutrient?9:4,r=(a[t.nutrient]*i).toFixed(0),c="Recommended"===a.name&&o[t.nutrient].covidNote?'<br><span style="color:#6366f1;font-style:italic">'.concat(o[t.nutrient].covidNote,"</span>"):"";j.style("opacity",1).html('\n          <div style="font-weight:bold;text-transform:capitalize;color:'.concat(p[t.nutrient],'">').concat(t.nutrient,'</div>\n          <div style="margin:4px 0">\n            <b>Amount:</b> ').concat(n,"g\n            <br><b>Percentage:</b> ").concat(s,"%\n            <br><b>Calories:</b> ").concat(r," kcal\n            ").concat(c,"\n          </div>\n        ")).style("left",e.pageX+10+"px").style("top",e.pageY-28+"px"),l.Ltv(this).attr("stroke","#333").attr("stroke-width",2)})).on("mouseout",(function(){j.style("opacity",0),l.Ltv(this).attr("stroke","white").attr("stroke-width",1)}));const b=u.append("g").attr("class","legend").attr("transform","translate(".concat(d+20,", 0)"));h.forEach(((e,t)=>{const a=b.append("g").attr("transform","translate(0, ".concat(25*t,")"));a.append("rect").attr("width",15).attr("height",15).attr("fill",p[e]),a.append("text").attr("x",24).attr("y",12).attr("text-anchor","start").style("text-transform","capitalize").style("font-size","14px").text(e)})),null!==t&&void 0!==t&&t.covid_condition&&u.append("text").attr("x",d/2).attr("y",m+40).attr("text-anchor","middle").attr("font-size","12px").attr("font-style","italic").attr("fill","#6366f1").text("Note: RDA values adjusted for Long COVID recovery needs");const N=u.append("g").attr("class","calorie-info").attr("transform","translate(".concat(d+20,", ").concat(25*h.length+20,")"));return N.append("text").attr("font-size","14px").attr("font-weight","bold").text("Total Calories:"),N.append("text").attr("y",25).attr("font-size","14px").text("Intake: ".concat((e=>(4*e.protein+4*e.carbs+9*e.fat).toFixed(0))(a)," kcal")),N.append("text").attr("y",50).attr("font-size","14px").text("Recommended: ".concat(o.calories.value.toFixed(0)," kcal")),()=>{l.Ltv(".d3-tooltip").remove()}}),[i,o,a,t]),(0,c.jsx)("div",{className:"w-full",children:(0,c.jsx)("div",{ref:i,className:"macro-chart mx-auto overflow-visible",style:{minHeight:"350px"}})})}function p(e){let{data:t,userData:a,foodDatabase:i}=e;const o=(0,s.useRef)(null),[r,h]=(0,s.useState)([]);return(0,s.useEffect)((()=>{if(!t||0===t.length)return;const e=new Date,s=new Date;s.setDate(e.getDate()-7);const i=u(s),o=t.filter((e=>{try{return t=e.date,a=i,m(t)>=m(a)}catch(n){return console.warn("Error parsing date:",e.date),!1}var t,a})).map(((e,t)=>{try{let t=e.efficiency||e.metabolicEfficiency;return!t||t<=0?(console.log("Recalculating efficiency for ".concat(e.name," (was ").concat(t,")")),t=d(e,a)):console.log("Using existing efficiency for ".concat(e.name,": ").concat(t)),(0,n.A)((0,n.A)({},e),{},{originalEfficiency:e.efficiency||80,efficiency:t,actualEnergy:Math.round(e.calories*(t/100)),wastedEnergy:Math.round(e.calories*((100-t)/100))})}catch(s){console.warn("Error processing meal ".concat(t,":"),s);const a=e.efficiency||e.metabolicEfficiency||80;return(0,n.A)((0,n.A)({},e),{},{efficiency:a,actualEnergy:Math.round(e.calories*(a/100)),wastedEnergy:Math.round(e.calories*((100-a)/100))})}})).filter((e=>"Pre-workout"!==e.mealType&&"Post-workout"!==e.mealType));console.log("ProcessedData with preserved efficiency:",o),h(o)}),[t,a,i]),(0,s.useEffect)((()=>{if(!o.current||!r||0===r.length)return;l.Ltv(o.current).selectAll("*").remove();const e=60,t=120,a=140,n=70,s=800-n-t,i=500-e-a,c=l.Ltv(o.current).append("svg").attr("width",s+n+t).attr("height",i+e+a).append("g").attr("transform","translate(".concat(n,",").concat(e,")"));c.append("text").attr("x",s/2).attr("y",-30).attr("text-anchor","middle").style("font-size","18px").style("font-weight","bold").text("Metabolic Efficiency Chart"),c.append("text").attr("x",s/2).attr("y",-10).attr("text-anchor","middle").style("font-size","14px").style("font-style","italic").text("How efficiently your body converts food into usable energy");const d=l.Ltv("body").append("div").attr("class","chart-tooltip").style("position","absolute").style("visibility","hidden").style("background-color","white").style("border","1px solid #ddd").style("border-radius","5px").style("padding","12px").style("font-size","14px").style("box-shadow","0 3px 14px rgba(0,0,0,0.25)").style("z-index","10").style("max-width","300px"),m=[],h=new Date;for(let o=6;o>=0;o--){const e=new Date;e.setDate(h.getDate()-o);const t=u(e);m.push(t)}console.log("=== CHART DEBUG ==="),console.log("processedData:",r);const g=[],p=l.Os0(r,(e=>e.date)),f=m;f.forEach((e=>{const t=p.get(e)||[];if(t.length>0){l.Os0(t,(e=>e.mealType)).forEach(((t,a)=>{const n=l.czq(t,(e=>e.calories)),s=t.reduce(((e,t)=>{const a=t.efficiency||0,s=n>0?t.calories/n:0;return console.log("Meal: ".concat(t.name,", efficiency: ").concat(a,", calories: ").concat(t.calories,", weight: ").concat(s)),e+a*s}),0);console.log("Combined efficiency for ".concat(a," on ").concat(e,": ").concat(s));const i=l.czq(t,(e=>e.actualEnergy||e.calories*(e.efficiency/100))),o=n-i;g.push({date:e,mealType:a,time:t[0].time,name:"".concat(a," (").concat(t.length," items)"),efficiency:Math.round(s),calories:n,actualEnergy:i,wastedEnergy:o,originalMeals:t})}))}})),console.log("Final combinedData:",g),console.log("=== END CHART DEBUG ===");const v=[...g].sort(((e,t)=>e.date!==t.date?e.date.localeCompare(t.date):e.time.localeCompare(t.time))),x=l.WH().domain(f).range([0,s]).padding(.2),y=l.WH().domain(["Breakfast","Morning Snack","Lunch","Afternoon Snack","Dinner","Late Night Snack"]).range([0,x.bandwidth()]).padding(.1),j=l.T9B(g,(e=>e.calories))||1e3,b=l.m4Y().domain([0,j]).range([i,0]),N=l.m4Y().domain([0,100]).range([i,0]);c.append("g").attr("transform","translate(0,".concat(i,")")).call(l.l78(x).tickFormat((e=>{const t=e.split("-");return"".concat(parseInt(t[1]),"/").concat(parseInt(t[2]))}))).selectAll("text").style("text-anchor","end").attr("dx","-.8em").attr("dy",".15em").attr("transform","rotate(-45)"),c.append("g").call(l.V4s(b)).append("text").attr("transform","rotate(-90)").attr("y",-50).attr("x",-i/2).attr("text-anchor","middle").style("fill","#000").text("Calories"),c.append("g").attr("transform","translate(".concat(s,", 0)")).call(l.eH3(N)).append("text").attr("transform","rotate(-90)").attr("y",50).attr("x",-i/2).attr("text-anchor","middle").style("fill","#000").text("Metabolic Efficiency (%)");const C={Breakfast:"#FF9F1C","Morning Snack":"#FFB84D",Lunch:"#2EC4B6","Afternoon Snack":"#4ECDC4",Dinner:"#E71D36","Late Night Snack":"#FF6B6B"};if(g.forEach((e=>{const t=C[e.mealType]||"#999999",a=x(e.date)+y(e.mealType),n=y.bandwidth();c.append("rect").attr("class","actual-energy-bar").attr("x",a).attr("y",b(e.actualEnergy)).attr("width",n).attr("height",i-b(e.actualEnergy)).attr("fill",t).attr("opacity",.9).attr("stroke","#333").attr("stroke-width",1).on("mouseover",(function(t){l.Ltv(this).attr("opacity",.7),d.style("visibility","visible").html('\n            <div style="font-weight:bold;margin-bottom:10px;font-size:15px;">'.concat(e.date," - ").concat(e.mealType,'</div>\n            <div style="margin-bottom:6px;">Total Calories: ').concat(Math.round(e.calories),'</div>\n            <div style="margin-bottom:6px;"><strong>Usable Energy: ').concat(Math.round(e.actualEnergy)," cal (").concat(e.efficiency,'% efficient)</strong></div>\n            <div style="margin-bottom:12px;">Energy Lost: ').concat(Math.round(e.wastedEnergy),' cal</div>\n            <div style="font-weight:bold;margin-bottom:5px;">Individual Items:</div>\n            <ul style="margin-top:0;padding-left:20px;">\n              ').concat(e.originalMeals.map((t=>"\n                <li>".concat(t.name," - ").concat(t.calories," cal (").concat(t.efficiency||e.efficiency,"% efficient)</li>\n              "))).join(""),"\n            </ul>\n          ")).style("left","".concat(t.pageX+15,"px")).style("top","".concat(t.pageY-10,"px"))})).on("mouseout",(function(){l.Ltv(this).attr("opacity",.9),d.style("visibility","hidden")})),c.append("rect").attr("class","potential-energy-bar").attr("x",a).attr("y",b(e.calories)).attr("width",n).attr("height",b(e.actualEnergy)-b(e.calories)).attr("fill",t).attr("opacity",.3).attr("stroke","#333").attr("stroke-width",1).attr("stroke-dasharray","3,3").on("mouseover",(function(t){l.Ltv(this).attr("opacity",.5),d.style("visibility","visible").html('\n            <div style="font-weight:bold;margin-bottom:10px;font-size:15px;">'.concat(e.date," - ").concat(e.mealType,'</div>\n            <div style="margin-bottom:6px;">Total Calories: ').concat(Math.round(e.calories),'</div>\n            <div style="margin-bottom:6px;">Usable Energy: ').concat(Math.round(e.actualEnergy)," cal (").concat(e.efficiency,'% efficient)</div>\n            <div style="margin-bottom:12px;"><strong>Energy Lost: ').concat(Math.round(e.wastedEnergy)," cal</strong></div>\n          ")).style("left","".concat(t.pageX+15,"px")).style("top","".concat(t.pageY-10,"px"))})).on("mouseout",(function(){l.Ltv(this).attr("opacity",.3),d.style("visibility","hidden")}))})),v.length>0){const e=l.n8j().x((e=>x(e.date)+y(e.mealType)+y.bandwidth()/2)).y((e=>N(e.efficiency))).defined((e=>null!=e.efficiency)).curve(l.nVG);c.append("path").datum(v).attr("fill","none").attr("stroke","#FF5733").attr("stroke-width",3).attr("d",e),c.selectAll(".efficiency-point").data(g).enter().append("circle").attr("class","efficiency-point").attr("cx",(e=>x(e.date)+y(e.mealType)+y.bandwidth()/2)).attr("cy",(e=>N(e.efficiency))).attr("r",5).attr("fill","#FF5733").attr("stroke","#333").attr("stroke-width",1).on("mouseover",(function(e,t){l.Ltv(this).attr("r",8),d.style("visibility","visible").html('\n            <div style="font-weight:bold;font-size:16px;">'.concat(t.mealType," on ").concat(t.date,"</div>\n            <div>Metabolic Efficiency: <strong>").concat(t.efficiency,'%</strong></div>\n            <div style="margin-top:6px">Your body converts <strong>').concat(t.efficiency,"%</strong> of consumed calories into usable energy.</div>\n          ")).style("left","".concat(e.pageX+15,"px")).style("top","".concat(e.pageY-10,"px"))})).on("mouseout",(function(){l.Ltv(this).attr("r",5),d.style("visibility","hidden")}))}const w=i+80;c.append("line").attr("x1",10).attr("x2",40).attr("y1",w).attr("y2",w).attr("stroke","#FF5733").attr("stroke-width",3),c.append("circle").attr("cx",25).attr("cy",w).attr("r",5).attr("fill","#FF5733").attr("stroke","#333").attr("stroke-width",1),c.append("text").attr("x",50).attr("y",w+4).style("font-size","12px").text("Efficiency (%)");const A=[{label:"Usable Energy",color:"#2EC4B6",opacity:.9},{label:"Energy Lost",color:"#2EC4B6",opacity:.3}];c.selectAll(".legend-rect").data(A).enter().append("rect").attr("x",200).attr("y",((e,t)=>w-10+20*t)).attr("width",15).attr("height",15).attr("fill",(e=>e.color)).attr("opacity",(e=>e.opacity)).attr("stroke","#333").attr("stroke-width",1),c.selectAll(".legend-text").data(A).enter().append("text").attr("x",225).attr("y",((e,t)=>w+2+20*t)).style("font-size","12px").text((e=>e.label));const k=Object.entries(C).map((e=>{let[t,a]=e;return{type:t,color:a}}));return c.selectAll(".meal-type-rect").data(k).enter().append("rect").attr("x",((e,t)=>400+130*Math.floor(t/2))).attr("y",((e,t)=>w-10+t%2*20)).attr("width",15).attr("height",15).attr("fill",(e=>e.color)).attr("stroke","#333").attr("stroke-width",1),c.selectAll(".meal-type-text").data(k).enter().append("text").attr("x",((e,t)=>425+130*Math.floor(t/2))).attr("y",((e,t)=>w+2+t%2*20)).style("font-size","11px").text((e=>e.type)),()=>{l.Ltv(".chart-tooltip").remove()}}),[o,r,a]),r&&0!==r.length?(0,c.jsxs)("div",{className:"chart-container",children:[(0,c.jsx)("div",{ref:o,className:"efficiency-chart",style:{minHeight:"500px"}}),(0,c.jsxs)("div",{className:"chart-info",children:[(0,c.jsx)("h4",{children:"Understanding Metabolic Efficiency"}),(0,c.jsx)("p",{children:"Metabolic efficiency refers to how effectively your body converts the calories you consume into usable energy. The chart shows both the energy your body successfully uses (solid bars) and the energy that's lost during digestion and metabolism (transparent sections)."}),(0,c.jsx)("p",{children:(0,c.jsx)("strong",{children:"Key insights:"})}),(0,c.jsxs)("ul",{children:[(0,c.jsx)("li",{children:"Higher efficiency percentages mean more of your food energy is being utilized"}),(0,c.jsx)("li",{children:"The red line tracks your efficiency over time across different meals"}),(0,c.jsx)("li",{children:"Different meal types and timing can affect how efficiently your body processes food"}),(0,c.jsxs)("li",{children:[(0,c.jsx)("strong",{children:"Snack Timing:"})," Morning snacks (90%) are more efficient than late night snacks (60%)"]})]})]})]}):(0,c.jsx)("div",{className:"chart-container",children:(0,c.jsx)("div",{ref:o,className:"efficiency-chart",children:(0,c.jsx)("div",{className:"placeholder",children:(0,c.jsx)("p",{children:"No meal data available. Please add some meals to see your metabolic efficiency chart."})})})})}console.log("Expected result: ~74 (should be > 0)"),console.log("Actual result:",h),console.log("\n=== COMMON ISSUES TO CHECK ==="),console.log("1. Are protein/carbs/fat values numbers or strings?"),console.log("2. Is mealType exactly matching the case in mealTypeFactors?"),console.log('3. Is time format consistent (e.g., "8:00 AM" vs "8:00 am")?'),console.log("4. Is longCovidSeverity exactly matching the case in severityFactors?"),console.log("5. Are the macro values realistic (not 0 or undefined)?");const f=e=>{if(!e)return"";const[t,a]=e.split(" ");if(!t||!a)return e;let[n,s]=t.split(":"),i=parseInt(n,10);"AM"===a.toUpperCase()?12===i&&(i=0):"PM"===a.toUpperCase()&&12!==i&&(i+=12);const o=i.toString().padStart(2,"0");return"".concat(o,":").concat(s)};console.log("Testing convertTo24Hour function:"),console.log("12:30 AM ->",f("12:30 AM")),console.log("1:30 AM  ->",f("1:30 AM")),console.log("11:59 AM ->",f("11:59 AM")),console.log("12:00 PM ->",f("12:00 PM")),console.log("1:30 PM  ->",f("1:30 PM")),console.log("11:59 PM ->",f("11:59 PM"));const v=e=>{if(console.log("prepareChartData called with:",e),!e||!Array.isArray(e))return console.warn("prepareChartData: Invalid input data"),[];try{const a=e.map(((e,t)=>{try{let t=e.time||"12:00 PM";if(t.match(/^\d{1,2}:\d{2}$/)&&!t.includes("AM")&&!t.includes("PM")){const[a,n]=t.split(":"),s=parseInt(a,10),i=s<12?"AM":"PM";t="".concat(0===s?12:s>12?s-12:s,":").concat(n," ").concat(i),console.log("Converted time from ".concat(e.time," to ").concat(t))}return(0,n.A)((0,n.A)({},e),{},{time:t})}catch(a){return console.warn("Error processing meal ".concat(t," in prepareChartData:"),a),(0,n.A)((0,n.A)({},e),{},{time:"12:00 PM"})}}));return t=a,console.log("=== MEAL DATA DEBUGGER ==="),[...t].sort(((e,t)=>e.time.localeCompare(t.time))).forEach((e=>{console.log('Time: "'.concat(e.time,'" | ')+'MealType: "'.concat(e.mealType,'" | ')+'Date: "'.concat(e.date,'"'))})),console.log("=== END MEAL DATA ==="),console.log("prepareChartData completed successfully:",a.length,"items"),a}catch(a){return console.error("Error in prepareChartData:",a),e||[]}var t},x=e=>{let{data:t,maxPercent:a}=e;const n=Math.min(100,t.value/t.rda*100),s=Math.min(100,100),i=(o=n)>=100?"#4CAF50":o>=70?"#8BC34A":o>=50?"#FFC107":o>=30?"#FF9800":"#F44336";var o;return(0,c.jsxs)("div",{className:"bullet-chart",children:[(0,c.jsxs)("div",{className:"bullet-chart-header",children:[(0,c.jsxs)("div",{className:"bullet-chart-title",children:[(0,c.jsx)("span",{className:"nutrient-name",children:t.name}),t.isAdjusted&&(0,c.jsx)("span",{className:"adjusted-badge",children:"Adjusted"})]}),(0,c.jsxs)("div",{className:"bullet-chart-values",children:[t.value.toFixed(2)," / ",t.rda," ",t.unit,(0,c.jsxs)("span",{className:"bullet-chart-percentage",style:{color:i},children:["(",Math.round(n),"%)"]})]})]}),(0,c.jsxs)("div",{className:"bullet-chart-track",children:[(0,c.jsx)("div",{className:"threshold-marker",style:{left:"70%"}}),(0,c.jsx)("div",{className:"actual-value-bar",style:{width:"".concat(n,"%"),backgroundColor:i}}),(0,c.jsx)("div",{className:"target-line",style:{left:"".concat(s,"%")}})]})]})},y={vitamin_a:{value:900,unit:"mcg",femaleAdjust:.78,description:"Supports vision, immune function, and cell growth"},vitamin_c:{value:90,unit:"mg",femaleAdjust:.83,description:"Antioxidant that supports immune function and collagen production"},vitamin_d:{value:15,unit:"mcg",femaleAdjust:1,description:"Crucial for calcium absorption and bone health"},vitamin_e:{value:15,unit:"mg",femaleAdjust:1,description:"Antioxidant that protects cells from damage"},vitamin_b6:{value:1.3,unit:"mg",femaleAdjust:1,description:"Important for metabolism and brain development"},vitamin_b12:{value:2.4,unit:"mcg",femaleAdjust:1,description:"Essential for nerve function and blood cell formation"},folate:{value:400,unit:"mcg",femaleAdjust:1,description:"Critical for cell division and DNA synthesis"},iron:{value:8,unit:"mg",femaleAdjust:2.25,description:"Essential for oxygen transport in the blood"},calcium:{value:1e3,unit:"mg",femaleAdjust:1,description:"Critical for bone health and muscle function"},magnesium:{value:420,unit:"mg",femaleAdjust:.76,description:"Involved in over 300 biochemical reactions in the body"},zinc:{value:11,unit:"mg",femaleAdjust:.73,description:"Important for immune function and wound healing"},selenium:{value:55,unit:"mcg",femaleAdjust:1,description:"Antioxidant that helps protect cells from damage"},copper:{value:.9,unit:"mg",femaleAdjust:1,description:"Important for red blood cell formation and nerve function"},vitamin_b1:{value:1.2,unit:"mg",femaleAdjust:.92,description:"Essential for energy metabolism"},vitamin_b2:{value:1.3,unit:"mg",femaleAdjust:.85,description:"Important for energy production and cell function"},vitamin_b3:{value:16,unit:"mg",femaleAdjust:.875,description:"Helps convert food into energy"}};function j(e){let{data:t,userData:a}=e;const[i,o]=(0,s.useState)(a||{}),[r,l]=(0,s.useState)([]),[d,m]=(0,s.useState)([]),[u]=(0,s.useState)(t&&Object.keys(t).length>0?function(e,t){const a={};for(const s in t)if(t.hasOwnProperty(s)){const i=t[s];if(e&&void 0!==e[s]){const t=e[s];"object"===typeof t&&void 0!==t.value&&void 0!==t.unit?a[s]=(0,n.A)({},t):"number"===typeof t?a[s]={value:t,unit:i.unit}:(console.warn("Unexpected intake data format for ".concat(s,":"),t),a[s]={value:0,unit:i.unit})}else a[s]={value:0,unit:i.unit}}return a}(t,y):{}),[h,g]=(0,s.useState)({}),[p,f]=(0,s.useState)("all"),[v,j]=(0,s.useState)(!0),[b,N]=(0,s.useState)("all"),C=(0,s.useCallback)((e=>{switch(null===e||void 0===e?void 0:e.toLowerCase()){case"mild":return 1.1;case"moderate":return 1.3;case"severe":return 1.5;case"very severe":return 1.8;default:return 1}}),[]),w=(0,s.useCallback)(((e,t,a)=>t===a?e:"g"===t&&"mg"===a||"mg"===t&&"mcg"===a?1e3*e:"mcg"===t&&"mg"===a||"mg"===t&&"g"===a?.001*e:(console.warn("Unit conversion from ".concat(t," to ").concat(a," not defined for value ").concat(e)),e)),[]),A=(0,s.useCallback)(((e,t,a)=>{if("IU"!==(null===a||void 0===a?void 0:a.toUpperCase()))return t;return t*({vitamin_a:.3,vitamin_d:.025,vitamin_e:.67}[e]||1)}),[]),k=(0,s.useCallback)(((e,t)=>{const a=[];for(const s in t)if(t.hasOwnProperty(s)){var n;const i=t[s];if(!i||void 0===i.value||void 0===i.unit){console.warn("Skipping ".concat(s,": No valid RDA information (value or unit missing)."),i);continue}const o=e[s];let r=0,l=i.unit;o&&void 0!==o.value&&(r=o.value,l=o.unit||i.unit);let c=A(s,r,l);c=w(c,l,i.unit),!isNaN(c)&&isFinite(c)||(console.warn("Invalid standardized intake value for ".concat(s,". Setting to 0."),c),c=0);const d=c/i.value*100,m=Math.min(1e3,d),u=s.replace(/_/g," ").replace(/\b\w/g,(e=>e.toUpperCase())),h=(null===(n=y[s])||void 0===n?void 0:n.category)||(s.includes("vitamin")?"vitamins":"minerals");a.push({key:s,name:u,value:d,cappedValue:m,rawValue:r,standardizedValue:c,unit:l,rda:i.value,rdaUnit:i.unit,isAdjustedRDA:i.isAdjusted,isExtreme:d>1e3,percentOfRDA:d,category:h})}return a.sort(((e,t)=>e.percentOfRDA-t.percentOfRDA))}),[A,w]),S=(0,s.useCallback)((e=>{let t=[...e];"all"!==b&&(t=t.filter((e=>e.category===b))),"deficient"===p?(t=t.filter((e=>e.percentOfRDA<70)),t.sort(((e,t)=>e.percentOfRDA-t.percentOfRDA))):"optimal"===p?(t=t.filter((e=>e.percentOfRDA>=100)),t.sort(((e,t)=>t.percentOfRDA-e.percentOfRDA))):t.sort(((e,t)=>e.percentOfRDA-t.percentOfRDA)),l(t)}),[p,b]),D=(0,s.useCallback)(((e,t)=>{if(!e||0===Object.keys(e).length)return console.error("baseRDAData_ is empty or invalid!"),{};const a=JSON.parse(JSON.stringify(e));return Object.keys(a).forEach((s=>{var i;if(!a[s]||"number"!==typeof a[s].value)return console.error("Invalid data structure for ".concat(s," in baseRDAData_ or copy:"),a[s]),void(a[s]={value:0,unit:(null===(i=a[s])||void 0===i?void 0:i.unit)||"mg",isAdjusted:!1});let o=a[s].value;if(null!==t&&void 0!==t&&t.gender&&"female"===t.gender.toLowerCase()){o*=a[s].femaleAdjust||1}if(null!==t&&void 0!==t&&t.age){let e=1;t.age>=70?("vitamin_d"===s&&(e=1.2),"vitamin_b12"===s&&(e=1.1),"calcium"===s&&(e=1.15)):t.age>=50?("vitamin_d"===s&&(e=1.1),"vitamin_b12"===s&&(e=1.05)):t.age<=18&&("calcium"===s&&(e=1.15),"iron"===s&&(e=1.1)),1!==e&&(o*=e)}const r=(null===t||void 0===t?void 0:t.covid_severity)||(null===t||void 0===t?void 0:t.longCovidSeverity);if(r&&"None"!==r&&null!==r&&void 0!==r){const e=C(r);if(["vitamin_c","vitamin_d","zinc","selenium"].includes(s)){o*=Math.min(1.5*e,2.5)}else if(["vitamin_a","vitamin_e","vitamin_b6","vitamin_b12","folate","iron"].includes(s)){o*=Math.min(1.3*e,2)}else if(["magnesium","copper","vitamin_b1","vitamin_b2","vitamin_b3"].includes(s)){o*=Math.min(1.1*e,1.5)}}(isNaN(o)||!isFinite(o)||o<=0)&&(console.error("Invalid final value for ".concat(s,": ").concat(o,", resetting to base")),o=a[s].value);const l=Math.round(10*o)/10;a[s]=(0,n.A)((0,n.A)({},a[s]),{},{value:l,isAdjusted:l!==e[s].value})})),a}),[C]),F=e=>e>=100?{label:"Optimal",color:"#4CAF50"}:e>=70?{label:"Good",color:"#8BC34A"}:e>=50?{label:"Moderate",color:"#FFC107"}:e>=30?{label:"Low",color:"#FF9800"}:{label:"Very Low",color:"#F44336"},E=e=>{const t={};for(const n in y)t[n.replace(/_/g," ")]=y[n].description;const a=t[e.toLowerCase()];if(a)return a;for(const n in t)if(e.toLowerCase().includes(n))return t[n];return""};(0,s.useEffect)((()=>{j(!0);const e=setTimeout((()=>{try{const e=D(y,i);if(!e||0===Object.keys(e).length)return console.error("Failed to calculate RDA values"),void j(!1);g(e);const t=k(u,e);m(t),S(t)}catch(e){console.error("Error in MicronutrientChart useEffect:",e)}finally{j(!1)}}),500);return()=>clearTimeout(e)}),[i,u,D,k,S]),(0,s.useEffect)((()=>{d.length>0&&S(d)}),[p,b,d,S]);const M=()=>{var e,t;const a=[null,"mild","moderate","severe","very severe"],s=(null===(e=i.covid_severity)||void 0===e?void 0:e.toLowerCase())||(null===(t=i.longCovidSeverity)||void 0===t?void 0:t.toLowerCase())||null,r=a.indexOf(s),l=a[(r+1)%a.length],c=(0,n.A)((0,n.A)({},i),{},{covid_severity:l,longCovidSeverity:l,hasLongCovid:null!==l});null===l&&(delete c.covid_severity,delete c.longCovidSeverity,c.hasLongCovid=!1),o(c)},L=()=>{const e=i.covid_severity||i.longCovidSeverity;return e&&null!==e&&"None"!==e?e.charAt(0).toUpperCase()+e.slice(1):"None"},I=e=>{f(e)},T=e=>{N(e)};if(v)return(0,c.jsx)("div",{className:"loading-container",children:(0,c.jsxs)("div",{className:"loading-indicator",children:[(0,c.jsx)("div",{className:"spinner"}),(0,c.jsx)("p",{className:"loading-text",children:"Loading personalized micronutrient data..."})]})});const _=d.filter((e=>e.percentOfRDA<70)).length;return t&&0!==Object.keys(t).length||a&&0!==Object.keys(a).length?t&&0!==Object.keys(t).length&&0!==d.length?(0,c.jsxs)("div",{className:"micronutrient-chart-container",children:[(0,c.jsxs)("div",{className:"chart-card",children:[(0,c.jsxs)("div",{className:"chart-header",children:[(0,c.jsx)("h2",{className:"chart-title",children:"Micronutrient Status"}),(0,c.jsxs)("div",{className:"display-mode-buttons",children:[(0,c.jsxs)("button",{onClick:()=>I("all"),className:"mode-button ".concat("all"===p?"mode-button-active":""),children:["All (",d.length,")"]}),(0,c.jsxs)("button",{onClick:()=>I("deficient"),className:"mode-button ".concat("deficient"===p?"mode-button-deficient":""),children:["Deficient (",_,")"]}),(0,c.jsxs)("button",{onClick:()=>I("optimal"),className:"mode-button ".concat("optimal"===p?"mode-button-optimal":""),children:["Optimal (",d.filter((e=>e.percentOfRDA>=100)).length,")"]})]})]}),(0,c.jsxs)("div",{className:"category-filter",children:[(0,c.jsx)("button",{onClick:()=>T("all"),className:"category-button ".concat("all"===b?"category-button-active":""),children:"All Nutrients"}),(0,c.jsx)("button",{onClick:()=>T("vitamins"),className:"category-button ".concat("vitamins"===b?"category-button-active":""),children:"Vitamins"}),(0,c.jsx)("button",{onClick:()=>T("minerals"),className:"category-button ".concat("minerals"===b?"category-button-active":""),children:"Minerals"})]}),_>0&&(0,c.jsx)("div",{className:"deficiency-alert",children:(0,c.jsxs)("p",{className:"deficiency-message",children:[_," ",1===_?"nutrient is":"nutrients are"," below recommended levels."]})}),i.covid_severity&&"None"!==L()&&(0,c.jsxs)("div",{className:"covid-alert ".concat((e=>{switch(null===e||void 0===e?void 0:e.toLowerCase()){case"mild":return"covid-severity-mild";case"moderate":return"covid-severity-moderate";case"severe":return"covid-severity-severe";case"very severe":return"covid-severity-very-severe";default:return"covid-severity-unknown"}})(i.covid_severity)),children:[(0,c.jsxs)("p",{className:"covid-title",children:["Long COVID Condition - ",L()," Severity"]}),(0,c.jsx)("p",{className:"covid-description",children:"Recommended values have been adjusted for immune system support"})]}),(0,c.jsx)("div",{className:"chart-content",children:0===r.length&&d.length>0?(0,c.jsxs)("div",{className:"no-filter-results",children:[(0,c.jsx)("div",{className:"no-results-icon",children:"\ud83c\udfaf"}),(0,c.jsx)("h3",{className:"no-results-title",children:"Great news!"}),(0,c.jsxs)("p",{className:"no-results-message",children:["You don't have any ",(()=>{const e="deficient"===p?"below 70% RDA":"optimal"===p?"at 100%+ RDA":"";let t="vitamins"===b?"vitamins":"minerals"===b?"minerals":"nutrients";return e&&(t+=" ".concat(e)),t.trim()})()," to display.","deficient"===p&&" This means your nutrient levels are doing well in this category!","optimal"===p&&" Try logging more diverse meals to reach optimal levels."]}),(0,c.jsx)("p",{className:"no-results-suggestion",children:'Try selecting "All" to see your complete nutrient profile.'})]}):r.map((e=>(0,c.jsx)(x,{data:e,maxPercent:150,getNutrientStatus:F,getNutrientInfo:E},e.key)))}),(0,c.jsxs)("div",{className:"chart-legend",children:[(0,c.jsxs)("div",{className:"legend-item",children:[(0,c.jsx)("div",{className:"legend-color legend-optimal"}),(0,c.jsx)("span",{className:"legend-text",children:"\u2265 100% (Optimal)"})]}),(0,c.jsxs)("div",{className:"legend-item",children:[(0,c.jsx)("div",{className:"legend-color legend-good"}),(0,c.jsx)("span",{className:"legend-text",children:"70-99% (Good)"})]}),(0,c.jsxs)("div",{className:"legend-item",children:[(0,c.jsx)("div",{className:"legend-color legend-moderate"}),(0,c.jsx)("span",{className:"legend-text",children:"50-69% (Moderate)"})]}),(0,c.jsxs)("div",{className:"legend-item",children:[(0,c.jsx)("div",{className:"legend-color legend-low"}),(0,c.jsx)("span",{className:"legend-text",children:"30-49% (Low)"})]}),(0,c.jsxs)("div",{className:"legend-item",children:[(0,c.jsx)("div",{className:"legend-color legend-very-low"}),(0,c.jsx)("span",{className:"legend-text",children:"0-29% (Very Low)"})]}),(0,c.jsxs)("div",{className:"legend-item",children:[(0,c.jsx)("div",{className:"legend-target"}),(0,c.jsx)("span",{className:"legend-text",children:"Target (100% RDA)"})]}),(0,c.jsxs)("div",{className:"legend-item",children:[(0,c.jsx)("div",{className:"legend-threshold"}),(0,c.jsx)("span",{className:"legend-text",children:"Deficiency Threshold (70%)"})]})]})]}),(0,c.jsxs)("div",{className:"profile-card",children:[(0,c.jsx)("h3",{className:"profile-title",children:"User Profile"}),(0,c.jsxs)("div",{className:"profile-grid",children:[(0,c.jsxs)("div",{className:"profile-item",children:[(0,c.jsx)("p",{className:"profile-label",children:"Age"}),(0,c.jsxs)("p",{className:"profile-value",children:[(null===i||void 0===i?void 0:i.age)||"Not specified"," years"]})]}),(0,c.jsxs)("div",{className:"profile-item",children:[(0,c.jsx)("p",{className:"profile-label",children:"Gender"}),(0,c.jsx)("p",{className:"profile-value",children:null!==i&&void 0!==i&&i.gender?i.gender.charAt(0).toUpperCase()+i.gender.slice(1):"Not specified"})]}),(0,c.jsxs)("div",{className:"profile-item",children:[(0,c.jsx)("p",{className:"profile-label",children:"BMI"}),(0,c.jsx)("p",{className:"profile-value",children:null!==i&&void 0!==i&&i.weight&&null!==i&&void 0!==i&&i.height?(i.weight/Math.pow(i.height/100,2)).toFixed(1):"N/A"})]}),(0,c.jsxs)("div",{className:"profile-item",children:[(0,c.jsx)("p",{className:"profile-label",children:"Activity Level"}),(0,c.jsx)("p",{className:"profile-value",children:(null===i||void 0===i?void 0:i.activity_level)||"Not specified"})]}),(0,c.jsxs)("div",{className:"profile-item",children:[(0,c.jsx)("p",{className:"profile-label",children:"Medical Conditions"}),(0,c.jsx)("p",{className:"profile-value",children:null!==i&&void 0!==i&&i.medical_conditions&&i.medical_conditions.length>0?i.medical_conditions.map((e=>e.charAt(0).toUpperCase()+e.slice(1))).join(", "):"None"})]}),(0,c.jsxs)("div",{className:"profile-item",children:[(0,c.jsx)("p",{className:"profile-label",children:"COVID Status"}),(0,c.jsxs)("button",{onClick:M,className:"covid-toggle-button",style:{padding:"8px 12px",backgroundColor:"#e3f2fd",border:"2px solid #2196f3",borderRadius:"6px",cursor:"pointer",fontSize:"14px",fontWeight:"500",color:"#1976d2",transition:"all 0.2s ease",minWidth:"120px"},onMouseEnter:e=>{e.target.style.backgroundColor="#bbdefb",e.target.style.transform="scale(1.02)"},onMouseLeave:e=>{e.target.style.backgroundColor="#e3f2fd",e.target.style.transform="scale(1)"},children:[L()," (Click to change)"]})]})]})]})]}):(0,c.jsxs)("div",{className:"micronutrient-chart-container",children:[(0,c.jsxs)("div",{className:"chart-card",children:[(0,c.jsx)("div",{className:"chart-header",children:(0,c.jsx)("h2",{className:"chart-title",children:"Micronutrient Status"})}),(0,c.jsxs)("div",{className:"empty-state",children:[(0,c.jsx)("div",{className:"empty-state-icon",children:"\ud83d\udcca"}),(0,c.jsx)("h3",{className:"empty-state-title",children:"No Micronutrient Data Available"}),(0,c.jsx)("p",{className:"empty-state-description",children:"Once you log some meals, we'll analyze your nutrient intake and show your personalized micronutrient status here."})]})]}),(0,c.jsxs)("div",{className:"profile-card",children:[(0,c.jsx)("h3",{className:"profile-title",children:"User Profile"}),(0,c.jsxs)("div",{className:"profile-grid",children:[(0,c.jsxs)("div",{className:"profile-item",children:[(0,c.jsx)("p",{className:"profile-label",children:"Age"}),(0,c.jsxs)("p",{className:"profile-value",children:[(null===i||void 0===i?void 0:i.age)||"Not specified"," years"]})]}),(0,c.jsxs)("div",{className:"profile-item",children:[(0,c.jsx)("p",{className:"profile-label",children:"Gender"}),(0,c.jsx)("p",{className:"profile-value",children:null!==i&&void 0!==i&&i.gender?i.gender.charAt(0).toUpperCase()+i.gender.slice(1):"Not specified"})]}),(0,c.jsxs)("div",{className:"profile-item",children:[(0,c.jsx)("p",{className:"profile-label",children:"BMI"}),(0,c.jsx)("p",{className:"profile-value",children:null!==i&&void 0!==i&&i.weight&&null!==i&&void 0!==i&&i.height?(i.weight/Math.pow(i.height/100,2)).toFixed(1):"N/A"})]}),(0,c.jsxs)("div",{className:"profile-item",children:[(0,c.jsx)("p",{className:"profile-label",children:"Activity Level"}),(0,c.jsx)("p",{className:"profile-value",children:(null===i||void 0===i?void 0:i.activity_level)||"Not specified"})]}),(0,c.jsxs)("div",{className:"profile-item",children:[(0,c.jsx)("p",{className:"profile-label",children:"Medical Conditions"}),(0,c.jsx)("p",{className:"profile-value",children:null!==i&&void 0!==i&&i.medical_conditions&&i.medical_conditions.length>0?i.medical_conditions.map((e=>e.charAt(0).toUpperCase()+e.slice(1))).join(", "):"None"})]}),(0,c.jsxs)("div",{className:"profile-item",children:[(0,c.jsx)("p",{className:"profile-label",children:"COVID Status"}),(0,c.jsxs)("button",{onClick:M,className:"covid-toggle-button",style:{padding:"8px 12px",backgroundColor:"#e3f2fd",border:"2px solid #2196f3",borderRadius:"6px",cursor:"pointer",fontSize:"14px",fontWeight:"500",color:"#1976d2",transition:"all 0.2s ease",minWidth:"120px"},onMouseEnter:e=>{e.target.style.backgroundColor="#bbdefb",e.target.style.transform="scale(1.02)"},onMouseLeave:e=>{e.target.style.backgroundColor="#e3f2fd",e.target.style.transform="scale(1)"},children:[L()," (Click to change)"]})]})]})]})]}):(0,c.jsx)("div",{className:"micronutrient-chart-container",children:(0,c.jsxs)("div",{className:"chart-card",children:[(0,c.jsx)("div",{className:"chart-header",children:(0,c.jsx)("h2",{className:"chart-title",children:"Micronutrient Status"})}),(0,c.jsxs)("div",{className:"empty-state",children:[(0,c.jsx)("div",{className:"empty-state-icon",children:"\ud83d\udcca"}),(0,c.jsx)("h3",{className:"empty-state-title",children:"No Data Available"}),(0,c.jsx)("p",{className:"empty-state-description",children:"Please set up your profile and log some meals to see your personalized micronutrient analysis."})]})]})})}function b(e){let{foodLog:t,userProfile:a}=e;if(!t||!Array.isArray(t))return(0,c.jsxs)("div",{className:"analysis-error",children:[(0,c.jsx)("h3",{children:"Data Error"}),(0,c.jsx)("p",{children:"Unable to load food log data. Please try refreshing the page."})]});if(!a)return(0,c.jsxs)("div",{className:"analysis-error",children:[(0,c.jsx)("h3",{children:"Profile Error"}),(0,c.jsx)("p",{children:"User profile data is missing. Please check your account settings."})]});const n=u(new Date),s=t.length>0?t[0].date:n,i=t.filter((e=>e.date===n)),{macroSums:o,microSums:r,efficiencyData:l}=(()=>{if(0===t.length)return{macroSums:{},microSums:{},efficiencyData:[]};const e=t[0].date,a=t.filter((t=>t.date===e));console.log("=== DEBUGGING getChartData ==="),console.log("lastDayEntries:",a);const n=a.reduce(((e,t)=>(e.protein=(e.protein||0)+(parseFloat(t.protein)||0),e.carbs=(e.carbs||0)+(parseFloat(t.carbs)||0),e.fat=(e.fat||0)+(parseFloat(t.fat)||0),e.calories=(e.calories||0)+(parseFloat(t.calories)||0),e)),{});a.forEach(((e,t)=>{console.log("\nEntry ".concat(t,": ").concat(e.name)),console.log("micronutrients:",e.micronutrients),e.micronutrients?Object.entries(e.micronutrients).forEach((e=>{let[t,a]=e;console.log("  ".concat(t,":"),a)})):console.warn("\u274c No micronutrients data for ".concat(e.name))}));const s=a.reduce(((e,t)=>(t.micronutrients&&Object.entries(t.micronutrients).forEach((t=>{let[a,n]=t;if(!["protein","carbs","fat","calories","name","unit"].includes(a)){const t="object"===typeof n?n.value||0:n,s=parseFloat(t)||0;e[a]=(e[a]||0)+s,console.log("Adding ".concat(a,": ").concat(s,", running total: ").concat(e[a]))}})),e)),{});console.log("Final macroSums:",n),console.log("Final microSums:",s),console.log("=== END getChartData DEBUG ===\n");return{macroSums:n,microSums:s,efficiencyData:t}})();return(0,c.jsxs)("div",{className:"food-analysis-section",children:[(0,c.jsxs)("div",{className:"analysis-header",children:[(0,c.jsx)("h3",{children:"\ud83d\udcca Nutritional Analysis Dashboard"}),(0,c.jsxs)("p",{className:"analysis-date",children:["Analysis for ",s]}),(0,c.jsx)("div",{className:"analysis-summary",children:(0,c.jsxs)("span",{className:"summary-stat",children:[(0,c.jsx)("strong",{children:i.length})," meals logged today (",n,")"]})})]}),(0,c.jsxs)("div",{className:"charts-container",children:[(0,c.jsxs)("div",{className:"chart-wrapper",children:[(0,c.jsxs)("div",{className:"chart-header",children:[(0,c.jsx)("h4",{children:"\ud83c\udf4e Macronutrient Balance"}),(0,c.jsx)("p",{className:"chart-description",children:"Your protein, carbohydrate, and fat intake compared to personalized recommendations"})]}),(0,c.jsx)(g,{userData:a,userIntake:o})]}),(0,c.jsxs)("div",{className:"chart-wrapper",children:[(0,c.jsxs)("div",{className:"chart-header",children:[(0,c.jsx)("h4",{children:"\ud83d\udc8a Micronutrient Status"}),(0,c.jsx)("p",{className:"chart-description",children:"Essential vitamins and minerals as percentage of recommended daily amounts"})]}),(0,c.jsx)(j,{data:r,userData:a})]}),(0,c.jsxs)("div",{className:"chart-wrapper one",children:[(0,c.jsxs)("div",{className:"chart-header",children:[(0,c.jsx)("h4",{children:"\u26a1 Metabolic Efficiency"}),(0,c.jsx)("p",{className:"chart-description",children:"How effectively your body converts food calories into usable energy"})]}),(0,c.jsx)(p,{data:v(l),userData:a})]})]})]})}const N=["Breakfast","Morning Snack","Lunch","Afternoon Snack","Dinner","Late Night Snack"],C=["Add Food","Food Journal","Analysis"];const w=function(){var e;const t=(0,i.Zp)(),[a,l]=(0,s.useState)([]),[d,m]=(0,s.useState)("loading"),[u,h]=(0,s.useState)(!1),[g,p]=(0,s.useState)(null),[f,v]=(0,s.useState)({age:30,gender:"female",weight:65,height:165,activityLevel:"moderate",hasLongCovid:!1,longCovidSeverity:"moderate"}),[x,y]=(0,s.useState)(!0),[j,w]=(0,s.useState)("Add Food"),[A,k]=(0,s.useState)(""),[S,D]=(0,s.useState)([]),[F,E]=(0,s.useState)(null),[M,L]=(0,s.useState)({}),[I,T]=(0,s.useState)("Breakfast"),[_,O]=(0,s.useState)((()=>(new Date).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}))),[B,P]=(0,s.useState)((()=>(new Date).toISOString().slice(0,10))),[R,z]=(0,s.useState)(!0),[U,G]=(0,s.useState)(!1),[V,H]=(0,s.useState)(""),[W,J]=(0,s.useState)(""),[Y,q]=(0,s.useState)([]),[X,K]=(0,s.useState)(!1),[Z,Q]=(0,s.useState)(""),[$,ee]=(0,s.useState)(1),[te,ae]=(0,s.useState)(null),[ne,se]=(0,s.useState)(null),[ie,oe]=(0,s.useState)(!1),[re,le]=(0,s.useState)({}),ce=e=>{let{entryId:t,entryName:a,onConfirm:n,onCancel:s}=e;return(0,c.jsx)("div",{className:"modal-overlay",children:(0,c.jsxs)("div",{className:"delete-confirm-modal",children:[(0,c.jsx)("h3",{children:"\ud83d\uddd1\ufe0f Delete Food Entry"}),(0,c.jsx)("p",{children:"Are you sure you want to delete this food entry?"}),(0,c.jsx)("div",{className:"entry-preview",children:(0,c.jsx)("strong",{children:a})}),(0,c.jsx)("p",{className:"warning-text",children:"This action cannot be undone."}),(0,c.jsxs)("div",{className:"modal-actions",children:[(0,c.jsx)("button",{className:"cancel-button",onClick:s,disabled:ie,children:"Cancel"}),(0,c.jsx)("button",{className:"delete-button",onClick:()=>n(t),disabled:ie,children:ie?"Deleting...":"Delete Entry"})]})]})})},de=(0,s.useCallback)((async()=>{try{const e=localStorage.getItem("userData");if(!e)return void t("/login");const a=JSON.parse(e);p(a),a.id?await(async e=>{try{const t=(0,o.H9)(r.db,"users",e),a=await(0,o.x7)(t);if(a.exists()){const e=a.data();v(e)}else console.log("No user profile found in database"),v(null)}catch(t){console.error("Error fetching user profile:",t),J("Failed to load user profile"),v(null)}})(a.id):(console.log("No user ID found - user profile not loaded"),v(null))}catch(W){console.error("Error checking authentication:",W),t("/login")}finally{y(!1)}}),[t]);(0,s.useEffect)((()=>{de()}),[de]);const me=(0,s.useCallback)((async()=>{if(g&&g.id)try{const e=(0,o.P)((0,o.rJ)(r.db,"users",g.id,"food_journal"),(0,o.My)("date","desc"),(0,o.My)("createdAt","desc"),(0,o.AB)(20)),t=(await(0,o.GG)(e)).docs.map((e=>(0,n.A)({id:e.id},e.data())));q(t),0===t.length?console.log("No food log entries found - showing empty state"):console.log("Loaded ".concat(t.length," food log entries"))}catch(W){console.error("Error loading food log data:",W),J("Failed to load food log data"),q([])}}),[g]);(0,s.useEffect)((()=>{g&&g.id&&!x&&me()}),[g,x,me]);const ue=e=>{let{foodName:t,mealData:a}=e;if(a&&(a.longCovidRelevance||a.longCovidBenefits||a.longCovidCautions)){const e=a.longCovidRelevance||{},n=a.longCovidBenefits||[],s=a.longCovidCautions||[],i=a.functionalCompounds||{};let o="neutral";n.length>s.length&&(o="beneficial"),s.length>n.length&&(o="caution");const r=e.antiInflammatory||"unknown";return(0,c.jsxs)("div",{className:"long-covid-food-info ".concat(o),children:[(0,c.jsxs)("div",{className:"food-info-header",children:[(0,c.jsx)("span",{className:"category-icon ".concat(o),children:"beneficial"===o?"\u2705":"caution"===o?"\u26a0\ufe0f":"\u2139\ufe0f"}),(0,c.jsxs)("strong",{children:["Database Analysis: ",t]})]}),(0,c.jsxs)("div",{className:"inflammatory-level",children:[(0,c.jsx)("h5",{children:"\ud83d\udd25 Anti-Inflammatory Level"}),(0,c.jsxs)("div",{className:"level-indicator level-".concat(r),children:[(0,c.jsxs)("span",{className:"level-value",children:[" ",r.toUpperCase()]}),(0,c.jsx)("span",{className:"level-description",children:"high"===r?"Excellent for reducing inflammation":"moderate"===r?"Moderately helpful for inflammation":"low"===r?"Limited anti-inflammatory effects":"neutral"===r?"No significant inflammatory impact":"Not assessed"})]})]}),Object.keys(i).length>0&&(0,c.jsxs)("div",{className:"functional-compounds",children:[(0,c.jsx)("h5",{children:"\ud83e\uddec Functional Compounds"}),(0,c.jsx)("div",{className:"compounds-grid",children:Object.entries(i).map((e=>{let[t,a]=e;return(0,c.jsxs)("div",{className:"compound-item",children:[(0,c.jsx)("span",{className:"compound-name",children:t.replace(/_/g," ")}),(0,c.jsxs)("span",{className:"compound-level level-".concat(a),children:[" ",a]})]},t)}))})]}),n.length>0&&(0,c.jsxs)("div",{className:"benefits-list",children:[(0,c.jsx)("h5",{children:"\u2728 Benefits for Long COVID Recovery"}),(0,c.jsx)("ul",{children:n.map(((e,t)=>(0,c.jsx)("li",{children:e},t)))})]}),s.length>0&&(0,c.jsxs)("div",{className:"cautions-list",children:[(0,c.jsx)("h5",{children:"\u26a0\ufe0f Important Considerations"}),(0,c.jsx)("ul",{children:s.map(((e,t)=>(0,c.jsx)("li",{children:e},t)))})]})]})}return(0,c.jsxs)("div",{className:"no-food-info",children:[(0,c.jsx)("div",{className:"no-data-icon",children:"\ud83d\udcca"}),(0,c.jsx)("h4",{children:"No Long COVID Data Available"}),(0,c.jsx)("p",{children:"This food doesn't have specific Long COVID information in our database yet."}),(0,c.jsx)("p",{children:"Consider general anti-inflammatory principles:"}),(0,c.jsxs)("ul",{className:"general-tips",children:[(0,c.jsx)("li",{children:"Choose whole, unprocessed versions when possible"}),(0,c.jsx)("li",{children:"Pay attention to how it affects your symptoms"}),(0,c.jsx)("li",{children:"Consider portion sizes and frequency"}),(0,c.jsx)("li",{children:"Pair with known anti-inflammatory foods"})]})]})},he=e=>{let{selectedFood:t,selectedMeal:a,foodLog:n=[],isSearching:s=!1,searchTerm:i=""}=e;return t&&a?(0,c.jsxs)("div",{className:"long-covid-side-panel",children:[(0,c.jsx)("h3",{children:"\ud83e\udda0 Long COVID Nutrition Guide"}),(0,c.jsxs)("div",{className:"selected-food-analysis",children:[(0,c.jsx)(ue,{foodName:t,mealData:a}),(0,c.jsx)("div",{className:"back-to-guide",children:(0,c.jsx)("p",{className:"guide-hint",children:(0,c.jsx)("em",{children:"Clear selection to see the full nutrition guide"})})})]})]}):s&&i.length>=2?(0,c.jsxs)("div",{className:"long-covid-side-panel",children:[(0,c.jsx)("h3",{children:"\ud83e\udda0 Long COVID Nutrition Guide"}),(0,c.jsx)("div",{className:"search-status",children:(0,c.jsx)("p",{className:"search-hint",children:(0,c.jsxs)("em",{children:['Searching for "',i,'"... Select a food above to see its specific analysis.']})})}),(0,c.jsx)("div",{className:"nutrition-categories",children:(0,c.jsxs)("div",{className:"category-section beneficial",children:[(0,c.jsx)("h4",{children:"\u2705 Quick Anti-Inflammatory Guide"}),(0,c.jsx)("p",{children:"Focus on omega-3 rich fish, berries, leafy greens, and anti-inflammatory spices."})]})})]}):(0,c.jsxs)("div",{className:"long-covid-side-panel",children:[(0,c.jsx)("h3",{children:"\ud83e\udda0 Long COVID Nutrition Guide"}),(0,c.jsxs)("div",{className:"nutrition-categories",children:[(0,c.jsxs)("div",{className:"category-section beneficial",children:[(0,c.jsx)("h4",{children:"\u2705 Anti-Inflammatory Foods"}),(0,c.jsxs)("ul",{children:[(0,c.jsxs)("li",{children:[(0,c.jsx)("strong",{children:"Fatty Fish:"})," Salmon, mackerel, sardines (omega-3s)"]}),(0,c.jsxs)("li",{children:[(0,c.jsx)("strong",{children:"Berries:"})," Blueberries, strawberries (antioxidants)"]}),(0,c.jsxs)("li",{children:[(0,c.jsx)("strong",{children:"Leafy Greens:"})," Spinach, kale (vitamins, minerals)"]}),(0,c.jsxs)("li",{children:[(0,c.jsx)("strong",{children:"Nuts:"})," Walnuts, almonds (healthy fats)"]}),(0,c.jsxs)("li",{children:[(0,c.jsx)("strong",{children:"Turmeric:"})," Contains curcumin (anti-inflammatory)"]}),(0,c.jsxs)("li",{children:[(0,c.jsx)("strong",{children:"Ginger:"})," Natural anti-inflammatory"]}),(0,c.jsxs)("li",{children:[(0,c.jsx)("strong",{children:"Green Tea:"})," Polyphenols reduce inflammation"]})]})]}),(0,c.jsxs)("div",{className:"category-section neutral",children:[(0,c.jsx)("h4",{children:"\u2139\ufe0f Recommended Foods"}),(0,c.jsxs)("ul",{children:[(0,c.jsxs)("li",{children:[(0,c.jsx)("strong",{children:"Whole Grains:"})," Oats, quinoa, brown rice"]}),(0,c.jsxs)("li",{children:[(0,c.jsx)("strong",{children:"Lean Proteins:"})," Chicken, turkey, legumes"]}),(0,c.jsxs)("li",{children:[(0,c.jsx)("strong",{children:"Citrus Fruits:"})," High in vitamin C"]}),(0,c.jsxs)("li",{children:[(0,c.jsx)("strong",{children:"Olive Oil:"})," Monounsaturated fats"]}),(0,c.jsxs)("li",{children:[(0,c.jsx)("strong",{children:"Garlic & Onions:"})," Immune support"]})]})]}),(0,c.jsxs)("div",{className:"category-section caution",children:[(0,c.jsx)("h4",{children:"\u26a0\ufe0f Foods to Limit"}),(0,c.jsxs)("ul",{children:[(0,c.jsxs)("li",{children:[(0,c.jsx)("strong",{children:"Processed Foods:"})," High in inflammation-promoting ingredients"]}),(0,c.jsxs)("li",{children:[(0,c.jsx)("strong",{children:"Refined Sugars:"})," Can worsen inflammation"]}),(0,c.jsxs)("li",{children:[(0,c.jsx)("strong",{children:"Red/Processed Meat:"})," May increase inflammatory markers"]}),(0,c.jsxs)("li",{children:[(0,c.jsx)("strong",{children:"Trans Fats:"})," Found in margarine, processed foods"]}),(0,c.jsxs)("li",{children:[(0,c.jsx)("strong",{children:"Refined Carbs:"})," White bread, pastries"]}),(0,c.jsxs)("li",{children:[(0,c.jsx)("strong",{children:"Fried Foods:"})," High in inflammatory compounds"]})]})]})]}),(0,c.jsxs)("div",{className:"additional-tips",children:[(0,c.jsx)("h4",{children:"\ud83d\udca1 General Tips"}),(0,c.jsxs)("ul",{children:[(0,c.jsx)("li",{children:"Stay well hydrated (8+ glasses water daily)"}),(0,c.jsx)("li",{children:"Consider vitamin D supplementation"}),(0,c.jsx)("li",{children:"Eat regular, smaller meals to maintain energy"}),(0,c.jsx)("li",{children:"Focus on nutrient-dense, whole foods"}),(0,c.jsx)("li",{children:"Limit alcohol and caffeine if they worsen symptoms"})]})]})]})},ge=e=>{const t=e.toLowerCase();return["salmon","mackerel","sardines","tuna","trout","blueberries","strawberries","raspberries","blackberries","spinach","kale","broccoli","brussels sprouts","walnuts","almonds","chia seeds","flax seeds","turmeric","ginger","garlic","onion","olive oil","avocado","sweet potato","green tea","dark chocolate"].some((e=>t.includes(e)))?"beneficial":["processed meat","bacon","sausage","hot dog","french fries","fried chicken","fried","white bread","white rice","pastry","candy","soda","sugar","margarine","ice cream","chips"].some((e=>t.includes(e)))?"caution":"neutral"},pe=e=>{const t=e.time,a=t.match(/(\d+):/),n=a?parseInt(a[1],10):12,s=t.toLowerCase().includes("pm");let i=n;s&&12!==n&&(i+=12),s||12!==n||(i=0);const o=.2*(parseFloat(e.protein)||0),r=.1*(parseFloat(e.carbs)||0),l=.15*(parseFloat(e.fat)||0);let c=1;i<6||i>20?c=.7:i>=7&&i<=10?c=1.2:i>=17&&i<=19&&(c=.9);const d={Breakfast:1.3,"Morning Snack":.9,Lunch:1.1,"Afternoon Snack":.8,Dinner:.9,"Late Night Snack":.6,Snack:.8}[e.mealType]||1;let m=Math.min(100,10*(o+r+l))*c*d;if(e.longCovidAdjust&&null!==f&&void 0!==f&&f.hasLongCovid){m*={mild:.95,moderate:.85,severe:.75,"very severe":.65}[f.longCovidSeverity]||.85,e.longCovidBenefits&&e.longCovidBenefits.length>0&&(m*=1.1),e.longCovidCautions&&e.longCovidCautions.length>0&&(m*=.9)}return Math.min(100,Math.max(0,m))},fe=((e,t)=>{const[a,n]=(0,s.useState)(e);return(0,s.useEffect)((()=>{const a=setTimeout((()=>{n(e)}),t);return()=>clearTimeout(a)}),[e,t]),a})(A,300),ve=(0,s.useCallback)((async()=>{const e=A.toLowerCase().trim();if(e.length<2)return void D([]);if(re[e])return void D(re[e]);const t=(e,t)=>{const a=(e.name||"").toLowerCase(),n=(e.category||"").toLowerCase(),s=(e.description||"").toLowerCase();let i=0;a===t?i+=1:a.startsWith(t)?i+=.8:a.includes(t)&&(i+=.6),n.includes(t)&&(i+=.3),s.includes(t)&&(i+=.2);const o=a.split(" "),r=t.split(" ");let l=0;return r.forEach((e=>{o.forEach((t=>{t.startsWith(e)&&l++}))})),i+=l/Math.max(r.length,1)*.4,i},s=(e,a)=>a.filter((t=>{if(!t.name)return!1;const a=t.name.toLowerCase(),n=(t.category||"").toLowerCase(),s=(t.description||"").toLowerCase(),i=(t.longCovidBenefits||[]).join(" ").toLowerCase();return a.includes(e)||a.startsWith(e)||n.includes(e)||s.includes(e)||i.includes(e)||a.split(" ").some((t=>t.startsWith(e)))})).map((a=>(0,n.A)((0,n.A)({},a),{},{searchMethod:"javascript",searchScore:t(a,e)}))).sort(((t,a)=>{const n=(t.name||"").toLowerCase(),s=(a.name||"").toLowerCase();return n===e&&s!==e?-1:s===e&&n!==e?1:n.startsWith(e)&&!s.startsWith(e)?-1:s.startsWith(e)&&!n.startsWith(e)?1:(a.searchScore||0)-(t.searchScore||0)})).slice(0,15);try{console.log('\ud83d\udd0d Enhanced search for: "'.concat(e,'"'));let t=a;if(0===t.length){console.log("\ud83d\udce5 Fetching food database...");const e=(0,o.P)((0,o.rJ)(r.db,"meals"),(0,o.AB)(1e3));if(t=(await(0,o.GG)(e)).docs.map((e=>(0,n.A)({id:e.id},e.data()))),l(t),console.log("\ud83d\udcca Loaded ".concat(t.length," foods into cache")),window.pyodideReady&&!u)try{console.log("\ud83c\udfd7\ufe0f Building search index...");const e=await window.pyodide.runPython("\n              result = search_engine.build_index('".concat(JSON.stringify(t).replace(/'/g,"\\'"),"')\n              result\n            "));h(!0),window.searchIndexBuilt=!0,console.log("\u2705 Search index built:",e)}catch(W){console.error("\u274c Error building Python index:",W)}}let i=[];if(window.pyodideReady&&u)try{console.log("\ud83d\ude80 Using AI-powered search");const t=await window.pyodide.runPython('\n            results = search_engine.search("'.concat(e.replace(/"/g,'\\"'),'", 15)\n            json.dumps(results)\n          '));i=JSON.parse(t),console.log("\ud83c\udfaf AI search returned ".concat(i.length," results")),i=i.map((e=>(0,n.A)((0,n.A)({},e),{},{searchMethod:"ai",searchScore:e.search_score||0})))}catch(W){console.error("\u274c Python search failed, using fallback:",W),i=s(e,t)}else console.log("\ud83d\udcdd Using fallback JavaScript search"),i=s(e,t);le((t=>(0,n.A)((0,n.A)({},t),{},{[e]:i}))),D(i)}catch(i){console.error("\u274c Search error:",i),D([])}}),[A,re,a,u]);(0,s.useEffect)((()=>{const e=()=>{window.pyodideReady?m("ready"):window.pyodide?m("loading"):m("unavailable")};e();const t=()=>{m("ready"),console.log("\ud83c\udf89 Pyodide ready event received")},a=()=>{m("unavailable"),console.log("\u26a0\ufe0f Pyodide error event received")};window.addEventListener("pyodideReady",t),window.addEventListener("pyodideError",a);const n=setInterval(e,2e3);return()=>{window.removeEventListener("pyodideReady",t),window.removeEventListener("pyodideError",a),clearInterval(n)}}),[]),(0,s.useEffect)((()=>{fe.length<2?D([]):ve()}),[fe,ve]);const xe=e=>{var t,a,n,s,i;E(e),k(e.name),D([]);const o=(null===(t=e.nutrients)||void 0===t?void 0:t.per100g)||{};L({name:e.name,protein:(null===(a=o.protein)||void 0===a?void 0:a.value)||"",carbs:(null===(n=o.carbs)||void 0===n?void 0:n.value)||"",fat:(null===(s=o.fat)||void 0===s?void 0:s.value)||"",calories:(null===(i=o.calories)||void 0===i?void 0:i.value)||"",serving:100,micronutrients:o,longCovidBenefits:e.longCovidBenefits||[],longCovidCautions:e.longCovidCautions||[],longCovidRelevance:e.longCovidRelevance||{}})},ye=e=>{const{name:t,value:a}=e.target;"serving"===t?(L((e=>(0,n.A)((0,n.A)({},e),{},{[t]:a}))),(e=>{var t;if(!F||null===(t=F.nutrients)||void 0===t||!t.per100g)return;const a=parseFloat(e)/100;isNaN(a)||L((e=>{var t,s,i,o;const r=(0,n.A)({},e),l=F.nutrients.per100g;return r.protein=((null===(t=l.protein)||void 0===t?void 0:t.value)*a).toFixed(1),r.carbs=((null===(s=l.carbs)||void 0===s?void 0:s.value)*a).toFixed(1),r.fat=((null===(i=l.fat)||void 0===i?void 0:i.value)*a).toFixed(1),r.calories=((null===(o=l.calories)||void 0===o?void 0:o.value)*a).toFixed(0),r.micronutrients={},Object.entries(l).forEach((e=>{let[t,s]=e;["protein","carbs","fat","calories","name","unit"].includes(t)||(r.micronutrients[t]=(0,n.A)((0,n.A)({},s),{},{value:(s.value*a).toFixed(1)}))})),r}))})(a)):L((e=>(0,n.A)((0,n.A)({},e),{},{[t]:a})))},je=(0,s.useCallback)((async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if(g&&g.id){K(!0),1===e&&q([]),Q("");try{const t=(0,o.P)((0,o.rJ)(r.db,"users",g.id,"food_journal"),(0,o.My)("date","desc"),(0,o.My)("createdAt","desc"),(0,o.AB)(20*e)),a=(await(0,o.GG)(t)).docs.map((e=>(0,n.A)({id:e.id},e.data())));q(a),ee(e)}catch(t){console.error("Error fetching food log:",t),Q("Failed to load journal: ".concat(t.message))}finally{K(!1)}}}),[g]);(0,s.useEffect)((()=>{"Food Journal"===j&&g&&je(1)}),[j,g,je]);const be=()=>{t("/dashboard")};return x?(0,c.jsx)("div",{className:"food-tracker-container",children:(0,c.jsx)("div",{className:"loading-indicator",children:"Loading..."})}):g?(0,c.jsxs)("div",{className:"food-tracker-container",children:[ne&&(0,c.jsx)(ce,{entryId:ne,entryName:(null===(e=Y.find((e=>e.id===ne)))||void 0===e?void 0:e.name)||"Unknown",onConfirm:async e=>{if(g&&e){oe(!0),Q("");try{await(0,o.kd)((0,o.H9)(r.db,"users",g.id,"food_journal",e)),q((t=>t.filter((t=>t.id!==e)))),H("Food entry deleted successfully!"),setTimeout((()=>H("")),3e3)}catch(t){console.error("Error deleting entry:",t),Q("Failed to delete entry: ".concat(t.message))}finally{oe(!1),se(null)}}},onCancel:()=>se(null)}),(0,c.jsxs)("div",{className:"tracker-header",children:[(0,c.jsx)("button",{onClick:be,className:"back-button",children:"\u2190 Back to Dashboard"}),(0,c.jsx)("button",{onClick:async()=>{console.log("Logout clicked - starting complete logout process");try{console.log("Clearing localStorage userData"),localStorage.removeItem("userData"),sessionStorage.clear(),console.log("Cleared sessionStorage"),p(null),y(!1),console.log("Complete logout finished, navigating to login..."),t("/login",{replace:!0})}catch(W){console.error("Error during logout:",W),localStorage.removeItem("userData"),sessionStorage.clear(),p(null),t("/login",{replace:!0})}},className:"logout-btn",children:"Logout"})]}),(0,c.jsx)("h2",{children:"\ud83e\udde0 AI-Powered Meal Tracker"}),(0,c.jsxs)("div",{className:"ai-status-banner ".concat(d),children:["ready"===d&&(0,c.jsxs)("div",{className:"ai-ready",children:["\ud83d\ude80 ",(0,c.jsx)("strong",{children:"AI Search Enabled:"})," Advanced food matching with intelligent recommendations"]}),"loading"===d&&(0,c.jsxs)("div",{className:"ai-loading",children:["\ud83d\udd04 ",(0,c.jsx)("strong",{children:"Loading AI:"})," Preparing enhanced search capabilities..."]}),"unavailable"===d&&(0,c.jsxs)("div",{className:"ai-fallback",children:["\ud83d\udcdd ",(0,c.jsx)("strong",{children:"Basic Search:"})," AI unavailable, using standard search"]})]}),(0,c.jsx)("div",{className:"food-tabs",children:C.map((e=>(0,c.jsx)("button",{className:"food-tab".concat(j===e?" active":""),onClick:()=>w(e),children:e},e)))}),"Add Food"===j&&(0,c.jsxs)("div",{className:"food-form-section",children:[(0,c.jsxs)("div",{className:"food-form-left",children:[te&&(0,c.jsxs)("div",{className:"edit-mode-banner",children:[(0,c.jsxs)("div",{className:"edit-indicator",children:[(0,c.jsx)("span",{className:"edit-icon",children:"\u270f\ufe0f"}),(0,c.jsxs)("span",{className:"edit-text",children:[(0,c.jsx)("strong",{children:"Editing:"})," ",te.name]})]}),(0,c.jsx)("button",{className:"cancel-edit-btn",onClick:()=>{ae(null),L({}),E(null),k(""),H(""),J("")},type:"button",children:"Cancel Edit"})]}),(0,c.jsxs)("div",{className:"form-group long-covid-checkbox-group",children:[(0,c.jsxs)("label",{className:"long-covid-checkbox-label",children:[(0,c.jsx)("input",{type:"checkbox",checked:R,onChange:e=>z(e.target.checked),className:"long-covid-checkbox"}),(0,c.jsx)("span",{className:"checkbox-text",children:"I have Long COVID - Show food recommendations and adjustments"})]}),R&&(0,c.jsx)("div",{className:"long-covid-info-banner",children:(0,c.jsxs)("p",{children:["\ud83d\udd2c ",(0,c.jsx)("strong",{children:"Long COVID Mode:"})," Food recommendations will be adjusted to focus on anti-inflammatory options that may help manage symptoms and support recovery."]})})]}),(0,c.jsxs)("div",{className:"form-group search-group",children:[(0,c.jsx)("label",{children:"Search Food"}),(0,c.jsxs)("div",{className:"search-input-container",children:[(0,c.jsx)("input",{type:"text",value:A,onChange:e=>{k(e.target.value),E(null)},placeholder:"ready"===d?"\ud83e\udde0 AI-powered search ready...":"loading"===d?"\ud83d\udd04 Loading AI search...":"Search foods...",autoComplete:"off",className:"search-input enhanced-search"}),(0,c.jsxs)("div",{className:"search-status ".concat(d),children:["ready"===d&&u&&(0,c.jsx)("span",{className:"status-ready",children:"\ud83d\ude80 AI Search Active"}),"ready"===d&&!u&&(0,c.jsx)("span",{className:"status-indexing",children:"\u26a1 Building AI Index..."}),"loading"===d&&(0,c.jsx)("span",{className:"status-loading",children:"\ud83d\udd04 Loading AI..."}),"unavailable"===d&&(0,c.jsx)("span",{className:"status-basic",children:"\ud83d\udcdd Basic Search"}),S.length>0&&(0,c.jsxs)("span",{className:"result-count",children:["(",S.length," results)"]})]})]}),S.length>0&&(0,c.jsx)("ul",{className:"suggestions-list enhanced",children:S.map(((e,t)=>(0,c.jsxs)("li",{onClick:()=>xe(e),children:[(0,c.jsxs)("div",{className:"suggestion-main",children:[(0,c.jsx)("div",{className:"suggestion-name",children:e.name}),e.category&&(0,c.jsx)("div",{className:"suggestion-category",children:e.category}),(0,c.jsxs)("div",{className:"suggestion-meta",children:[e.searchScore&&(0,c.jsxs)("span",{className:"search-score",children:[(100*e.searchScore).toFixed(0),"% match"]}),"ai"===e.searchMethod&&(0,c.jsx)("span",{className:"ai-badge",children:"\ud83e\udde0 AI"}),"javascript"===e.searchMethod&&(0,c.jsx)("span",{className:"js-badge",children:"JS"}),e.match_type&&(0,c.jsx)("span",{className:"match-type",children:e.match_type})]})]}),(0,c.jsx)("div",{className:"suggestion-indicators",children:R&&(0,c.jsx)("span",{className:"covid-indicator ".concat(ge(e.name)),children:"beneficial"===ge(e.name)?"\u2705":"caution"===ge(e.name)?"\u26a0\ufe0f":"\u2139\ufe0f"})})]},e.id||t)))})]}),(0,c.jsxs)("div",{className:"form-row",children:[(0,c.jsxs)("div",{className:"form-group",children:[(0,c.jsx)("label",{children:"Protein (g)"}),(0,c.jsx)("input",{name:"protein",value:M.protein||"",onChange:ye,type:"number",step:"0.1"})]}),(0,c.jsxs)("div",{className:"form-group",children:[(0,c.jsx)("label",{children:"Carbs (g)"}),(0,c.jsx)("input",{name:"carbs",value:M.carbs||"",onChange:ye,type:"number",step:"0.1"})]}),(0,c.jsxs)("div",{className:"form-group",children:[(0,c.jsx)("label",{children:"Fat (g)"}),(0,c.jsx)("input",{name:"fat",value:M.fat||"",onChange:ye,type:"number",step:"0.1"})]}),(0,c.jsxs)("div",{className:"form-group",children:[(0,c.jsx)("label",{children:"Serving (g)"}),(0,c.jsx)("input",{name:"serving",value:M.serving||"",onChange:ye,type:"number",step:"1",className:"serving-input"})]})]}),(0,c.jsxs)("div",{className:"form-row",children:[(0,c.jsxs)("div",{className:"form-group",children:[(0,c.jsx)("label",{children:"Meal Type"}),(0,c.jsx)("select",{value:I,onChange:e=>T(e.target.value),children:N.map((e=>(0,c.jsx)("option",{value:e,children:e},e)))})]}),(0,c.jsxs)("div",{className:"form-group",children:[(0,c.jsx)("label",{children:"Time"}),(0,c.jsx)("input",{type:"time",value:(e=>{if(!e)return"";const[t,a]=e.split(" ");if(!t||!a)return e;let[n,s]=t.split(":");return"12"===n&&(n="00"),"PM"===a&&(n=String(parseInt(n,10)+12)),n=String(n),"".concat(n.padStart(2,"0"),":").concat(s)})(_),onChange:e=>{const t=e.target.value;if(!t)return;const a=new Date("2000-01-01T".concat(t)).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});O(a)}})]}),(0,c.jsxs)("div",{className:"form-group",children:[(0,c.jsx)("label",{children:"Date"}),(0,c.jsx)("input",{type:"date",value:B,onChange:e=>P(e.target.value)})]})]}),(0,c.jsxs)("div",{className:"form-group",children:[(0,c.jsx)("label",{children:"Calories"}),(0,c.jsx)("input",{name:"calories",value:M.calories||"",onChange:ye,type:"number",step:"1"})]}),(0,c.jsxs)("div",{className:"form-group",children:[(0,c.jsx)("button",{className:"submit-button ".concat(te?"update-mode":""),onClick:async()=>{if(g&&g.id){G(!0),J(""),H("");try{if(!M.name)throw new Error("Food name is required");const e={name:M.name,protein:parseFloat(M.protein)||0,carbs:parseFloat(M.carbs)||0,fat:parseFloat(M.fat)||0,calories:parseFloat(M.calories)||0,serving:parseFloat(M.serving)||100,micronutrients:M.micronutrients||{},mealType:I,time:_,date:B,longCovidAdjust:R,longCovidBenefits:M.longCovidBenefits||[],longCovidCautions:M.longCovidCautions||[],longCovidRelevance:M.longCovidRelevance||{},mealId:(null===F||void 0===F?void 0:F.id)||null};if(e.metabolicEfficiency=pe(e),te)await(0,o.mZ)((0,o.H9)(r.db,"users",g.id,"food_journal",te.id),(0,n.A)((0,n.A)({},e),{},{updatedAt:o.Dc.now()})),q((t=>t.map((t=>t.id===te.id?(0,n.A)((0,n.A)((0,n.A)({},t),e),{},{id:te.id}):t)))),H("Food entry updated successfully!"),ae(null);else{e.createdAt=o.Dc.now();const t=await(0,o.gS)((0,o.rJ)(r.db,"users",g.id,"food_journal"),e),a=(0,n.A)({id:t.id},e);q((e=>[a,...e])),H("Food logged successfully!")}L({}),E(null),k("")}catch(e){console.error("Error logging food:",e),J("Failed to ".concat(te?"update":"log"," food: ").concat(e.message))}finally{G(!1)}}else J("Please log in to save your meals")},disabled:U||!M.name,children:U?te?"Updating...":"Logging...":te?"Update Food":"Log Food"}),V&&(0,c.jsx)("div",{className:"success-message",children:V}),W&&(0,c.jsx)("div",{className:"error-message",children:W})]})]}),(0,c.jsxs)("div",{className:"food-form-right",children:[R&&(0,c.jsx)(he,{selectedFood:M.name,selectedMeal:F,foodLog:Y,isSearching:A.length>=2&&!F,searchTerm:A}),!R&&(0,c.jsxs)("div",{className:"general-nutrition-info",children:[(0,c.jsx)("h3",{children:"\ud83d\udcca Nutrition Tips"}),(0,c.jsx)("p",{children:"Enable Long COVID mode above to get personalized food recommendations and anti-inflammatory guidance."}),"ready"===d&&(0,c.jsx)("div",{className:"ai-tip",children:(0,c.jsxs)("p",{children:["\ud83d\udca1 ",(0,c.jsx)("strong",{children:"AI Tip:"})," The search above uses machine learning to find the most relevant foods for your queries!"]})})]})]})]}),"Food Journal"===j&&(0,c.jsxs)("div",{className:"food-journal-section",children:[(0,c.jsxs)("div",{className:"journal-header",children:[(0,c.jsx)("h3",{children:"Your Food Journal"}),(0,c.jsx)("button",{className:"refresh-button",onClick:()=>je(1),disabled:X,children:X?"Loading...":"Refresh"})]}),Z&&(0,c.jsx)("div",{className:"error-message",children:Z}),V&&(0,c.jsx)("div",{className:"success-message",children:V}),X&&0===Y.length?(0,c.jsx)("div",{className:"loading-indicator",children:"Loading your food journal..."}):0===Y.length?(0,c.jsxs)("div",{className:"empty-state",children:[(0,c.jsx)("p",{children:"No entries found in your food journal."}),(0,c.jsx)("p",{children:'Start by adding a meal in the "Add Food" tab!'})]}):(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("div",{className:"journal-summary",children:(0,c.jsxs)("p",{children:["Showing ",Y.length," meal entries"]})}),(0,c.jsx)("div",{className:"journal-table-container",children:(0,c.jsxs)("table",{className:"food-log-table compact",children:[(0,c.jsx)("thead",{children:(0,c.jsxs)("tr",{children:[(0,c.jsx)("th",{className:"date-time-col",children:"Date/Time"}),(0,c.jsx)("th",{className:"meal-type-col",children:"Meal"}),(0,c.jsx)("th",{className:"food-col",children:"Food"}),(0,c.jsx)("th",{className:"serving-col",children:"Serving"}),(0,c.jsx)("th",{className:"macro-col",children:"P"}),(0,c.jsx)("th",{className:"macro-col",children:"C"}),(0,c.jsx)("th",{className:"macro-col",children:"F"}),(0,c.jsx)("th",{className:"calories-col",children:"Cal"}),(0,c.jsx)("th",{className:"efficiency-col",children:"Eff%"}),(0,c.jsx)("th",{className:"actions-col",children:"Actions"})]})}),(0,c.jsx)("tbody",{children:Y.map((e=>(0,c.jsxs)("tr",{children:[(0,c.jsx)("td",{className:"date-time-cell",children:((e,t)=>{const a=e.split("-"),n=parseInt(a[1],10),s=parseInt(a[2],10),i=t.replace(":00","").replace(" ","");return"".concat(n,"/").concat(s," ").concat(i)})(e.date,e.time)}),(0,c.jsx)("td",{className:"meal-type-cell",children:(0,c.jsx)("span",{className:"meal-badge ".concat((e.mealType||"unknown").trim().toLowerCase().replace(/\s+/g,"-")),children:(e=>{switch(e){case"Breakfast":return"B";case"Morning Snack":return"MS";case"Lunch":return"L";case"Afternoon Snack":return"AS";case"Dinner":return"D";case"Late Night Snack":return"LN";case"Snack":return"S";default:return e.charAt(0)}})(e.mealType||"Unknown")})}),(0,c.jsx)("td",{className:"food-cell",title:e.name,children:e.name.length>20?"".concat(e.name.substring(0,20),"..."):e.name}),(0,c.jsxs)("td",{className:"serving-cell",children:[e.serving||"0","g"]}),(0,c.jsx)("td",{className:"macro-cell",children:"number"===typeof e.protein?e.protein.toFixed(1):e.protein||"0"}),(0,c.jsx)("td",{className:"macro-cell",children:"number"===typeof e.carbs?e.carbs.toFixed(1):e.carbs||"0"}),(0,c.jsx)("td",{className:"macro-cell",children:"number"===typeof e.fat?e.fat.toFixed(1):e.fat||"0"}),(0,c.jsx)("td",{className:"calories-cell",children:e.calories||"0"}),(0,c.jsx)("td",{className:"efficiency-cell",children:(0,c.jsx)("span",{className:"efficiency-badge ".concat("number"===typeof e.metabolicEfficiency?e.metabolicEfficiency>=80?"high":e.metabolicEfficiency>=60?"medium":"low":"unknown"),children:"number"===typeof e.metabolicEfficiency?e.metabolicEfficiency.toFixed(0):"N/A"})}),(0,c.jsx)("td",{className:"actions-cell",children:(0,c.jsxs)("div",{className:"action-buttons compact",children:[(0,c.jsx)("button",{className:"edit-btn compact",onClick:()=>(e=>{L({name:e.name,protein:e.protein,carbs:e.carbs,fat:e.fat,calories:e.calories,serving:e.serving||100,micronutrients:e.micronutrients||{},longCovidBenefits:e.longCovidBenefits||[],longCovidCautions:e.longCovidCautions||[],longCovidRelevance:e.longCovidRelevance||{}}),T(e.mealType),O(e.time),P(e.date),z(e.longCovidAdjust||!1),k(e.name),ae(e),w("Add Food")})(e),title:"Edit entry",children:"\u270f\ufe0f"}),(0,c.jsx)("button",{className:"delete-btn compact",onClick:()=>se(e.id),title:"Delete entry",children:"\ud83d\uddd1\ufe0f"})]})})]},e.id)))})]})}),Y.length>=20*$&&(0,c.jsx)("div",{className:"load-more-container",children:(0,c.jsx)("button",{className:"load-more-button",onClick:()=>je($+1),disabled:X,children:X?"Loading...":"Load More Entries"})})]})]}),"Analysis"===j&&(0,c.jsx)(b,{foodLog:Y,userProfile:f})]}):(0,c.jsx)("div",{className:"food-tracker-container",children:(0,c.jsxs)("div",{className:"auth-required",children:[(0,c.jsx)("h2",{children:"Authentication Required"}),(0,c.jsx)("p",{children:"Please log in to use the food tracker."}),(0,c.jsx)("button",{onClick:be,className:"back-button",children:"Back to Dashboard"})]})})}}}]);
//# sourceMappingURL=924.8a4a35d1.chunk.js.map